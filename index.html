<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOS Sovereign V75 - Dopamine Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        :root { --primary: #3b82f6; --accent: #8b5cf6; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #030305; color: #fff; min-height: 100vh; overflow-x: hidden; }
        
        /* Dynamic Background */
        .bg-animate {
            position: fixed; inset: 0; z-index: -1;
            background: 
                radial-gradient(circle at 15% 50%, rgba(59, 130, 246, 0.08), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(139, 92, 246, 0.08), transparent 25%);
            animation: breathe 10s infinite alternate;
        }
        @keyframes breathe { 0% { opacity: 0.5; transform: scale(1); } 100% { opacity: 1; transform: scale(1.1); } }

        .glass-panel { background: rgba(20, 20, 25, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); border-radius: 1.5rem; }
        .glass-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 1rem; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; position: relative; overflow: hidden; }
        .glass-card:hover { background: rgba(255, 255, 255, 0.06); transform: translateY(-2px); border-color: rgba(255, 255, 255, 0.15); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }

        /* Timeline Elements */
        .timeline-container { position: relative; padding-left: 20px; }
        .timeline-line { position: absolute; left: 85px; top: 30px; bottom: -30px; width: 2px; background: linear-gradient(to bottom, rgba(255,255,255,0.1), transparent); }
        .timeline-time { width: 60px; text-align: right; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: 700; opacity: 0.5; padding-top: 1.5rem; }
        
        /* Status Dots */
        .status-dot { width: 12px; height: 12px; border-radius: 50%; position: absolute; left: 79px; top: 32px; z-index: 10; border: 2px solid #030305; box-shadow: 0 0 15px currentColor; transition: transform 0.3s; }
        .group:hover .status-dot { transform: scale(1.3); }

        /* Progress Circle (Life Score) */
        .progress-ring__circle { transition: stroke-dashoffset 1s ease-in-out; transform: rotate(-90deg); transform-origin: 50% 50%; }

        /* Task Animations */
        @keyframes checkPop { 0% { transform: scale(1); } 50% { transform: scale(1.4); } 100% { transform: scale(1); } }
        .checkbox-anim:checked { animation: checkPop 0.2s ease-in-out; background-color: #10b981; border-color: #10b981; }
        .task-done { text-decoration: line-through; opacity: 0.4; filter: grayscale(1); }

        /* Zen Mode Overlay */
        #zenMode { transition: opacity 0.5s ease; pointer-events: none; opacity: 0; }
        #zenMode.active { pointer-events: all; opacity: 1; }

        /* Utilities */
        .btn-gradient { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); box-shadow: 0 0 20px rgba(37, 99, 235, 0.3); transition: 0.3s; }
        .btn-gradient:hover { box-shadow: 0 0 30px rgba(37, 99, 235, 0.5); transform: translateY(-1px); }
        .btn-record { animation: pulseRed 2s infinite; }
        @keyframes pulseRed { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8 selection:bg-blue-500/30">
    <div class="bg-animate"></div>

    <div class="max-w-[1800px] mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8">
        
        <aside class="lg:col-span-3 flex flex-col gap-6 h-[calc(100vh-4rem)] sticky top-8">
            <div class="glass-panel p-6 flex flex-col h-full relative overflow-hidden">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h1 class="text-2xl font-black tracking-tighter">Life<span class="text-blue-500 italic">OS</span></h1>
                        <p class="text-[10px] font-bold text-zinc-500 tracking-widest uppercase mt-1">Sovereign V75</p>
                    </div>
                    <div class="relative w-16 h-16 flex items-center justify-center cursor-pointer group" onclick="alert('Score de vie calcul√© sur: T√¢ches, Eau, Routines')">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle class="text-white/5" stroke-width="8" stroke="currentColor" fill="transparent" r="42" cx="50" cy="50"/>
                            <circle id="scoreRing" class="text-blue-500 progress-ring__circle" stroke-width="8" stroke-linecap="round" stroke="currentColor" fill="transparent" r="42" cx="50" cy="50" stroke-dasharray="264" stroke-dashoffset="264"/>
                        </svg>
                        <span id="scoreText" class="absolute text-sm font-black group-hover:scale-110 transition-transform">0%</span>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="flex justify-between items-end mb-3">
                        <p class="text-[10px] font-bold uppercase tracking-widest text-zinc-500">Calendrier</p>
                        <button onclick="goToToday()" class="text-[9px] bg-blue-500/10 text-blue-400 px-2 py-1 rounded hover:bg-blue-500/20 transition">Aujourd'hui</button>
                    </div>
                    <div id="calendar" class="grid grid-cols-7 gap-1.5 text-center"></div>
                </div>

                <div class="flex-1 flex flex-col min-h-0 relative group">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-zinc-500 mb-2">Assistant IA</p>
                    <div class="relative flex-1">
                        <textarea id="userInput" class="w-full h-full bg-black/30 border border-white/10 rounded-xl p-4 text-sm outline-none resize-none focus:border-blue-500/50 transition-colors placeholder:text-zinc-700 font-medium leading-relaxed" placeholder="Planifier ma journ√©e... (ex: 'Gym √† 18h, Lire 20min')"></textarea>
                        <button onclick="toggleVoice()" id="micBtn" class="absolute bottom-3 right-3 w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center hover:bg-white/20 transition text-zinc-400 hover:text-white">üéôÔ∏è</button>
                    </div>
                    <button onclick="traiterBatch()" class="btn-gradient w-full mt-3 py-3 rounded-xl text-[11px] font-black uppercase tracking-widest hover:scale-[1.02] active:scale-95 transition-all">Ex√©cuter</button>
                </div>

                <div class="pt-6 mt-6 border-t border-white/5">
                    <div class="flex justify-between items-end mb-2">
                        <div class="flex items-center gap-2">
                            <span class="text-xl">üíß</span>
                            <span class="text-[10px] font-bold uppercase text-blue-400">Hydratation</span>
                        </div>
                        <div class="text-right">
                            <span id="waterText" class="text-xl font-black font-mono">0L</span>
                            <span id="waterTarget" class="text-[10px] opacity-50">/ 2.5L</span>
                        </div>
                    </div>
                    <div class="h-1.5 w-full bg-white/5 rounded-full overflow-hidden mb-3">
                        <div id="waterBar" class="h-full w-0 bg-blue-500 shadow-[0_0_10px_#3b82f6] transition-all duration-700"></div>
                    </div>
                    <button onclick="addWater(0.25)" class="w-full py-2 bg-blue-500/10 border border-blue-500/20 rounded-lg text-[10px] font-bold hover:bg-blue-500/20 active:bg-blue-500/30 transition text-blue-300">+ 250ml (Verre)</button>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-9 space-y-6 pb-20">
            <div class="glass-panel p-8 md:p-10 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-[80px] pointer-events-none"></div>

                <div class="flex flex-col md:flex-row justify-between md:items-end mb-8 relative z-10">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span id="liveIndicator" class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_10px_#10b981] animate-pulse"></span>
                            <span class="text-[10px] font-bold uppercase tracking-[0.2em] opacity-60">Tableau de Bord</span>
                        </div>
                        <h2 id="hudDate" class="text-4xl md:text-6xl font-black tracking-tight text-white mb-2">Date</h2>
                        <div id="quoteBox" class="text-sm font-medium text-zinc-400 italic border-l-2 border-white/20 pl-3">"La discipline est la cl√© de la libert√©."</div>
                    </div>
                    
                    <div class="flex gap-4 mt-6 md:mt-0">
                        <button onclick="toggleZenMode()" class="glass-card px-5 py-3 flex items-center gap-3 hover:bg-purple-500/20 border-purple-500/30 group">
                            <span class="text-2xl group-hover:scale-110 transition">üß†</span>
                            <div class="text-left">
                                <p class="text-[9px] font-bold uppercase text-purple-400 tracking-wider">Deep Work</p>
                                <p class="text-xs font-bold">Lancer Session</p>
                            </div>
                        </button>
                        <div class="glass-card px-5 py-3 text-right border-orange-500/30 bg-orange-500/5">
                            <p class="text-[9px] font-bold uppercase text-orange-400 tracking-wider mb-1">Cible (TDEE)</p>
                            <p id="calTarget" class="text-xl font-mono font-bold text-white">2400 <span class="text-xs opacity-50">kcal</span></p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                    <div id="contextCard" class="glass-card p-4 flex items-center gap-4 border-l-4 border-l-blue-500">
                        <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center text-2xl">‚öñÔ∏è</div>
                        <div>
                            <p class="text-[9px] font-black uppercase tracking-widest text-blue-400">Mode Actif</p>
                            <p id="contextTitle" class="text-lg font-bold">Standard</p>
                        </div>
                    </div>
                    <div onclick="playMusic()" class="glass-card p-4 flex items-center justify-between group hover:border-green-500/50">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center text-xl group-hover:animate-spin">üéµ</div>
                            <div>
                                <p class="text-[9px] font-black uppercase tracking-widest text-green-400">Ambiance</p>
                                <p id="musicLabel" class="text-sm font-bold truncate max-w-[150px]">Lofi Focus</p>
                            </div>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-white text-black flex items-center justify-center text-xs font-black">‚ñ∂</div>
                    </div>
                </div>

                <div class="relative mt-12">
                    <h3 class="text-xs font-bold uppercase tracking-[0.2em] text-zinc-600 mb-8 pl-12">Flux Chronologique</h3>
                    <div id="masterTimeline"></div>
                </div>
            </div>
        </main>
    </div>

    <div id="zenMode" class="fixed inset-0 z-[100] bg-[#050505] flex flex-col items-center justify-center">
        <button onclick="toggleZenMode()" class="absolute top-8 right-8 text-zinc-500 hover:text-white transition text-sm font-bold uppercase tracking-widest">‚úï Quitter</button>
        
        <div class="text-center space-y-8">
            <div class="inline-block px-4 py-1 rounded-full bg-purple-500/10 border border-purple-500/20 text-purple-400 text-[10px] font-bold uppercase tracking-[0.3em] mb-4">Deep Work Station</div>
            <div id="timerDisplay" class="text-[12rem] font-black leading-none font-mono tracking-tighter text-white tabular-nums">25:00</div>
            
            <div class="flex items-center justify-center gap-6">
                <button onclick="adjustTimer(-5)" class="text-zinc-600 hover:text-white font-bold text-2xl">-5</button>
                <button onclick="toggleTimer()" id="timerBtn" class="w-20 h-20 rounded-full bg-white text-black flex items-center justify-center text-3xl pl-1 hover:scale-110 transition shadow-[0_0_40px_rgba(255,255,255,0.3)]">‚ñ∂</button>
                <button onclick="adjustTimer(5)" class="text-zinc-600 hover:text-white font-bold text-2xl">+5</button>
            </div>

            <div class="grid grid-cols-3 gap-4 mt-12 bg-white/5 p-2 rounded-2xl">
                <button onclick="toggleNoise(this, 'rain')" class="p-4 rounded-xl hover:bg-white/10 text-2xl transition opacity-50">üåßÔ∏è</button>
                <button onclick="toggleNoise(this, 'cafe')" class="p-4 rounded-xl hover:bg-white/10 text-2xl transition opacity-50">‚òï</button>
                <button onclick="toggleNoise(this, 'white')" class="p-4 rounded-xl hover:bg-white/10 text-2xl transition opacity-50">üåä</button>
            </div>
            <p class="text-xs text-zinc-500 mt-4 font-mono">Ne brisez pas le flow.</p>
        </div>
    </div>

    <script>
        /* --- CORE DATA & STATE --- */
        let db = JSON.parse(localStorage.getItem('lifeos_v75_db') || "{}");
        let health = JSON.parse(localStorage.getItem('lifeos_v75_health') || '{"water":0}');
        let profile = { weight: 80, height: 180, age: 30, sex: 'male' }; // Simplified for addictive demo
        
        const now = new Date();
        const todayNum = now.getDate();
        let selectedDay = todayNum;
        let isRecording = false;

        /* --- CONTENT DATABASES --- */
        const QUOTES = [
            "Ce que tu ne fais pas d√©termine ce que tu es.",
            "La douleur de la discipline ou la douleur du regret.",
            "Sois l'architecte, pas la victime.",
            "Concentre-toi sur l'√©tape, pas sur le sommet.",
            "Le confort est l'ennemi du progr√®s."
        ];
        
        const MEALS = {
            sport: ["P√¢tes Bolo Prot√©in√©es", "Riz & Steak Hach√© 5%", "Poulet Curry Coco", "Omelette 4 oeufs + Toast"],
            focus: ["Saumon & Quinoa", "Salade C√©sar Light", "Wok L√©gumes Tofu", "Maquereau & Patates"],
            diet: ["Blanc de Poulet & Brocolis", "Salade Compos√©e Thon", "Soupe Maison", "Cabillaud Vapeur"]
        };

        const PLAYLISTS = {
            sport: "https://www.youtube.com/results?search_query=gym+phonk",
            focus: "https://www.youtube.com/results?search_query=deep+focus+binaural",
            chill: "https://www.youtube.com/results?search_query=lofi+girl"
        };

        /* --- INIT --- */
        document.getElementById('quoteBox').innerText = `"${QUOTES[selectedDay % QUOTES.length]}"`;
        renderAll();

        /* --- LOGIC: RENDER --- */
        function renderAll() {
            renderCalendar();
            renderTimeline();
            updateWaterUI();
            updateLifeScore();
        }

        function renderCalendar() {
            const c = document.getElementById('calendar'); c.innerHTML = '';
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            
            for(let i = Math.max(1, todayNum - 2); i <= Math.min(daysInMonth, todayNum + 4); i++) {
                const isSel = i === selectedDay;
                const isTod = i === todayNum;
                const hasData = db[i] && db[i].length > 0;
                
                const div = document.createElement('div');
                div.className = `p-2 rounded-lg cursor-pointer transition text-xs font-bold flex flex-col items-center justify-center h-14 border ${isSel ? 'bg-white text-black border-white shadow-[0_0_15px_rgba(255,255,255,0.3)]' : 'bg-white/5 border-white/5 hover:bg-white/10 text-zinc-400'}`;
                div.onclick = () => { selectedDay = i; renderAll(); };
                div.innerHTML = `<span>${i}</span>${hasData ? '<span class="w-1 h-1 rounded-full bg-blue-500 mt-1"></span>' : ''}`;
                c.appendChild(div);
            }
        }

        function renderTimeline() {
            const container = document.getElementById('masterTimeline');
            const tasks = db[selectedDay] || [];
            
            // Auto-detect Context
            let mode = 'diet';
            if(tasks.some(t => t.text.match(/sport|gym|crossfit|foot|muscu/i))) mode = 'sport';
            else if(tasks.some(t => t.text.match(/code|projet|√©tude|r√©union/i))) mode = 'focus';
            
            // Update HUD styling based on context
            const ctxCard = document.getElementById('contextCard');
            const musicLbl = document.getElementById('musicLabel');
            const styles = {
                sport: { t: "Athl√®te", c: "border-l-orange-500", i: "üî•", m: "Gym Phonk" },
                focus: { t: "Deep Focus", c: "border-l-purple-500", i: "üß†", m: "Binaural Beats" },
                diet: { t: "R√©cup√©ration", c: "border-l-green-500", i: "üåø", m: "Lofi Chill" }
            };
            
            ctxCard.className = `glass-card p-4 flex items-center gap-4 border-l-4 ${styles[mode].c} transition-all duration-500`;
            ctxCard.querySelector('div').innerText = styles[mode].i;
            document.getElementById('contextTitle').innerText = styles[mode].t;
            musicLbl.innerText = styles[mode].m;
            musicLbl.dataset.link = PLAYLISTS[mode];

            // Build Timeline Items
            let items = [];
            
            // 1. Core Meals (Auto-generated if empty)
            const rot = (selectedDay) % 4;
            items.push({ type: 'meal', time: '12:30', text: MEALS[mode][rot], sub: 'D√©jeuner' });
            items.push({ type: 'meal', time: '20:00', text: MEALS['diet'][rot], sub: 'D√Æner' });
            
            // 2. User Tasks
            tasks.forEach((t, idx) => {
                items.push({ type: 'task', time: t.time, text: t.text, done: t.done, id: idx, mode: mode });
            });

            // Sort by time
            items.sort((a, b) => parseInt(a.time.replace(':','')) - parseInt(b.time.replace(':','')));

            // HTML Generation
            const currentMin = now.getHours() * 60 + now.getMinutes();
            let html = '';

            items.forEach(item => {
                const [h, m] = item.time.split(':').map(Number);
                const itemMin = h * 60 + m;
                const isPast = (selectedDay === todayNum && itemMin < currentMin);
                
                let content = '';
                let colorClass = 'text-white';
                
                if (item.type === 'meal') {
                    colorClass = 'text-emerald-400';
                    content = `<div class="flex justify-between items-center opacity-80 hover:opacity-100"><div class="flex flex-col"><span class="text-[9px] font-bold uppercase ${colorClass} tracking-widest">Repas</span><span class="font-medium text-lg">${item.text}</span></div><button class="text-xs bg-white/10 px-2 py-1 rounded hover:bg-white/20">üç≥</button></div>`;
                } else {
                    colorClass = item.mode === 'sport' ? 'text-orange-400' : 'text-blue-400';
                    content = `
                        <div class="flex items-center gap-4 group" onclick="toggleTask(${item.id})">
                            <input type="checkbox" ${item.done ? 'checked' : ''} class="w-6 h-6 rounded-md border-2 border-white/20 bg-transparent checked:bg-green-500 checked:border-green-500 appearance-none cursor-pointer checkbox-anim transition-all">
                            <span class="text-lg font-bold ${item.done ? 'task-done' : ''}">${item.text}</span>
                            <button onclick="event.stopPropagation(); deleteTask(${item.id})" class="ml-auto opacity-0 group-hover:opacity-100 text-red-500 hover:bg-red-500/10 p-2 rounded transition">üóëÔ∏è</button>
                        </div>
                    `;
                }

                html += `
                    <div class="timeline-container mb-6 ${isPast && !item.done ? 'opacity-50' : ''}">
                        <div class="timeline-time">${item.time}</div>
                        <div class="status-dot" style="color: ${item.done ? '#10b981' : (item.type === 'meal' ? '#10b981' : '#3b82f6')}"></div>
                        <div class="timeline-line"></div>
                        <div class="glass-card p-5 ml-[85px] hover:scale-[1.01] transition-transform ${item.done ? 'bg-green-500/5 border-green-500/20' : ''}">
                            ${content}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html || '<p class="text-center text-zinc-600 italic py-10">Aucune mission planifi√©e.</p>';
        }

        /* --- LOGIC: ACTIONS --- */
        function toggleTask(id) {
            db[selectedDay][id].done = !db[selectedDay][id].done;
            if(db[selectedDay][id].done) triggerConfetti();
            save();
            renderAll();
        }

        function deleteTask(id) {
            if(confirm('Supprimer cette t√¢che ?')) {
                db[selectedDay].splice(id, 1);
                save();
                renderAll();
            }
        }

        function addWater(amount) {
            health.water += amount;
            save();
            updateWaterUI();
            updateLifeScore();
        }

        function updateWaterUI() {
            const target = 2.5;
            const pct = Math.min(100, (health.water / target) * 100);
            document.getElementById('waterText').innerText = `${health.water.toFixed(2)}L`;
            document.getElementById('waterBar').style.width = `${pct}%`;
        }

        function traiterBatch() {
            const txt = document.getElementById('userInput').value;
            if(!txt.trim()) return;

            // Simple NLP parser
            const lines = txt.split(/[\n,]+/);
            if (!db[selectedDay]) db[selectedDay] = [];

            lines.forEach(line => {
                const timeMatch = line.match(/(\d{1,2})[h:](\d{2})?/);
                let time = "09:00";
                if(timeMatch) {
                    time = `${timeMatch[1].padStart(2,'0')}:${(timeMatch[2]||'00')}`;
                } else {
                    // Smart auto-scheduling (finds next empty slot)
                    // Simplified for demo: adds to end or defaults
                }
                
                const cleanText = line.replace(/(\d{1,2})[h:](\d{2})?/g, "").replace(/\b(√†|vers|pour)\b/g, "").trim();
                
                if(cleanText) {
                    db[selectedDay].push({ time: time, text: cleanText.charAt(0).toUpperCase() + cleanText.slice(1), done: false });
                }
            });

            document.getElementById('userInput').value = '';
            save();
            renderAll();
            triggerConfetti();
        }

        /* --- LOGIC: GAMIFICATION & UX --- */
        function updateLifeScore() {
            // Formula: (Tasks Done % * 0.6) + (Water % * 0.4)
            const tasks = db[todayNum] || [];
            const taskScore = tasks.length ? (tasks.filter(t => t.done).length / tasks.length) * 100 : 0;
            const waterScore = Math.min(100, (health.water / 2.5) * 100);
            
            const totalScore = Math.round((taskScore * 0.6) + (waterScore * 0.4));
            
            // Update Ring
            const circle = document.getElementById('scoreRing');
            const radius = circle.r.baseVal.value;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (totalScore / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            document.getElementById('scoreText').innerText = `${totalScore}%`;
            
            // Color change based on score
            if(totalScore > 80) circle.classList.replace('text-blue-500', 'text-green-500');
            else if(totalScore > 50) circle.classList.replace('text-red-500', 'text-blue-500');
            else circle.classList.add('text-blue-500');
        }

        function triggerConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#3b82f6', '#10b981', '#ffffff']
            });
        }

        function playMusic() {
            const link = document.getElementById('musicLabel').dataset.link;
            window.open(link, '_blank');
        }

        function goToToday() {
            selectedDay = todayNum;
            renderAll();
        }

        /* --- LOGIC: ZEN MODE --- */
        let zenInterval;
        let zenTime = 25 * 60;
        let isZenRunning = false;

        function toggleZenMode() {
            const el = document.getElementById('zenMode');
            el.classList.toggle('active');
        }

        function toggleTimer() {
            const btn = document.getElementById('timerBtn');
            if(isZenRunning) {
                clearInterval(zenInterval);
                isZenRunning = false;
                btn.innerText = "‚ñ∂";
            } else {
                isZenRunning = true;
                btn.innerText = "‚è∏";
                zenInterval = setInterval(() => {
                    zenTime--;
                    updateTimerDisplay();
                    if(zenTime <= 0) {
                        clearInterval(zenInterval);
                        new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play();
                        alert("Session termin√©e !");
                        isZenRunning = false;
                    }
                }, 1000);
            }
        }

        function updateTimerDisplay() {
            const m = Math.floor(zenTime / 60).toString().padStart(2,'0');
            const s = (zenTime % 60).toString().padStart(2,'0');
            document.getElementById('timerDisplay').innerText = `${m}:${s}`;
        }

        function adjustTimer(min) {
            zenTime += min * 60;
            if(zenTime < 60) zenTime = 60;
            updateTimerDisplay();
        }

        // Fake Noise Generator for Demo (In real app, use Audio objects)
        function toggleNoise(btn, type) {
            btn.style.opacity = btn.style.opacity === '1' ? '0.5' : '1';
        }

        /* --- LOGIC: VOICE INPUT (Web Speech API) --- */
        function toggleVoice() {
            if (!('webkitSpeechRecognition' in window)) {
                alert("Votre navigateur ne supporte pas la reconnaissance vocale.");
                return;
            }

            if(isRecording) return; // Simple debounce

            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'fr-FR';
            recognition.start();
            isRecording = true;
            document.getElementById('micBtn').classList.add('btn-record', 'text-red-500', 'bg-white');

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                const input = document.getElementById('userInput');
                input.value = transcript + (input.value ? '\n' + input.value : '');
                traiterBatch(); // Auto-submit
            };

            recognition.onend = function() {
                isRecording = false;
                document.getElementById('micBtn').classList.remove('btn-record', 'text-red-500', 'bg-white');
            };
        }

        function save() {
            localStorage.setItem('lifeos_v75_db', JSON.stringify(db));
            localStorage.setItem('lifeos_v75_health', JSON.stringify(health));
        }
    </script>
</body>
</html>
