<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>LifeOS Sovereign V18 - Holistic Ecosystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020202; color: #fff; -webkit-font-smoothing: antialiased; }
        .glass { border-radius: 2.5rem; border: 1px solid rgba(128,128,128,0.1); backdrop-filter: blur(40px); background: rgba(255,255,255,0.02); }
        
        @keyframes blink-red { 0%, 100% { border-color: rgba(239, 68, 68, 0.2); } 50% { border-color: #ef4444; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); } }
        @keyframes blink-orange { 0%, 100% { border-color: rgba(249, 115, 22, 0.2); } 50% { border-color: #f97316; box-shadow: 0 0 15px rgba(249, 115, 22, 0.4); } }
        
        .alert-retard { animation: blink-red 1.5s infinite ease-in-out; border: 2px solid #ef4444 !important; }
        .alert-today { animation: blink-orange 2s infinite ease-in-out; border: 2px solid #f97316 !important; }

        .day { aspect-ratio: 1; border-radius: 1.2rem; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; cursor: pointer; position: relative; transition: 0.3s; background: rgba(255,255,255,0.01); border: 1px solid rgba(255,255,255,0.03); }
        .day:hover { transform: scale(1.1); background: rgba(59, 130, 246, 0.2); }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; position: absolute; bottom: 8px; }
        .btn-premium { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); transition: 0.3s; font-weight: 800; }
        
        .water-bar { height: 8px; border-radius: 4px; background: rgba(59, 130, 246, 0.1); overflow: hidden; }
        .water-progress { height: 100%; background: #3b82f6; transition: width 0.5s ease; box-shadow: 0 0 10px #3b82f6; }
        .youtube-btn { background: #ff0000; color: white; font-weight: 800; font-size: 10px; padding: 4px 8px; border-radius: 6px; transition: 0.3s; }
        .youtube-btn:hover { background: #cc0000; transform: scale(1.05); }
    </style>
</head>
<body class="p-4 md:p-10 min-h-full">

    <main class="max-w-7xl mx-auto space-y-8">
        <header class="flex justify-between items-center px-4">
            <div>
                <h1 class="text-4xl font-black italic tracking-tighter italic">LIFE<span class="text-blue-500">OS</span></h1>
                <p id="clock" class="text-[9px] uppercase tracking-[0.5em] opacity-40 font-bold mt-2">...</p>
            </div>
            <div class="flex items-center gap-6">
                <div class="text-right">
                    <p class="text-[9px] font-black opacity-30 uppercase">VitalitÃ© Globale</p>
                    <span id="score" class="text-3xl font-black italic text-blue-500">0%</span>
                </div>
                <button onclick="localStorage.clear(); location.reload();" class="w-10 h-10 rounded-full glass flex items-center justify-center opacity-20 hover:opacity-100 text-xs">âœ•</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-5 space-y-6">
                <div class="glass p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-blue-500 font-bold text-[10px] uppercase tracking-widest italic">Neural Logic Center</h2>
                        <button onclick="toggleVoice()" id="voiceBtn" class="p-3 glass rounded-full hover:bg-blue-600 transition-colors">ðŸŽ¤</button>
                    </div>
                    <textarea id="userInput" class="w-full bg-transparent outline-none text-2xl font-light mb-6" rows="4" placeholder="Votre Ã©tat ou mission..."></textarea>
                    <button onclick="traiter()" id="btnMain" class="w-full btn-premium py-5 rounded-3xl uppercase text-[10px] tracking-widest">Lancer l'Analyse Holistique</button>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div class="glass p-6 space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-[9px] font-black uppercase opacity-40">Hydratation</span>
                            <span class="text-xs font-bold text-blue-400"><span id="waterCount">0</span>/3L</span>
                        </div>
                        <div class="water-bar"><div id="waterBar" class="water-progress" style="width: 0%"></div></div>
                        <div class="flex gap-2">
                            <button onclick="addWater(0.5)" class="flex-1 py-2 glass rounded-xl text-[10px] font-bold">+0.5L</button>
                            <button onclick="resetWater()" class="px-3 py-2 glass rounded-xl text-[10px] opacity-30">â†»</button>
                        </div>
                    </div>
                    <div class="glass p-6 space-y-4 text-center">
                        <span class="text-[9px] font-black uppercase opacity-40">IntensitÃ© Sport</span>
                        <div class="flex justify-center gap-2">
                            <button onclick="setSport(1)" id="s1" class="w-8 h-8 glass rounded-full flex items-center justify-center text-xs">ðŸ”¥</button>
                            <button onclick="setSport(2)" id="s2" class="w-8 h-8 glass rounded-full flex items-center justify-center text-xs">ðŸ”¥ðŸ”¥</button>
                            <button onclick="setSport(3)" id="s3" class="w-8 h-8 glass rounded-full flex items-center justify-center text-xs">ðŸ”¥ðŸ”¥ðŸ”¥</button>
                        </div>
                        <p class="text-[8px] opacity-30 uppercase font-black" id="sportStatus">Aucun effort</p>
                    </div>
                </div>

                <div id="coachCard" class="glass p-8 border-purple-500/20 opacity-40 space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-purple-500 font-bold text-[9px] uppercase italic">âš¡ Neural Academy</h3>
                        <a id="ytLink" target="_blank" class="hidden youtube-btn uppercase">Voir la Solution ðŸŽ¬</a>
                    </div>
                    <p id="coachTxt" class="text-sm italic opacity-80 leading-relaxed">...</p>
                </div>
            </div>

            <div class="lg:col-span-7 glass p-10 flex flex-col justify-between shadow-2xl">
                <div>
                    <h2 class="text-zinc-500 font-bold text-[10px] uppercase tracking-widest mb-10">Roadmap DÃ©cembre 2025</h2>
                    <div id="calendar" class="grid grid-cols-7 gap-4"></div>
                </div>
                <div class="mt-10 border-t border-white/5 pt-8 grid grid-cols-2 gap-10">
                    <div>
                        <h4 class="text-red-500 font-bold text-[10px] uppercase mb-2">Alerte PrioritÃ©</h4>
                        <div id="prioList" class="text-xs opacity-50 font-bold italic">---</div>
                    </div>
                    <div class="text-right">
                        <h4 class="text-blue-400 font-bold text-[10px] uppercase mb-2">Gain de Temps IA</h4>
                        <div id="timeTip" class="text-xs opacity-50 italic">---</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="dayModal" class="hidden fixed inset-0 z-[150] flex items-center justify-center p-6 bg-black/90 backdrop-blur-3xl">
        <div class="glass p-12 max-w-lg w-full space-y-8 relative border-white/10">
            <h2 id="modalDate" class="text-3xl font-black tracking-tighter italic text-blue-500 capitalize">Date</h2>
            <div class="flex gap-2">
                <input type="text" id="newTaskInput" placeholder="Mission rapide..." class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10 text-sm">
                <button onclick="addTaskManually()" class="btn-premium px-6 rounded-2xl font-black">+</button>
            </div>
            <div id="taskList" class="space-y-4 max-h-[300px] overflow-y-auto pr-2"></div>
            <button onclick="closeDay()" class="w-full py-5 bg-white/5 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-white/10 transition-all">Fermer</button>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('lifeos_v18_db') || "{}");
        let health = JSON.parse(localStorage.getItem('lifeos_v18_health') || '{"water":0, "sport":0, "date":null}');
        const todayNum = new Date().getDate();
        let currentDayOpen = null;

        // Reset quotidien santÃ©
        if(health.date !== new Date().toDateString()) {
            health = {"water":0, "sport":0, "date":new Date().toDateString()};
            localStorage.setItem('lifeos_v18_health', JSON.stringify(health));
        }

        document.getElementById('clock').innerText = new Intl.DateTimeFormat('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' }).format(new Date());

        // --- SANTÃ‰ ENGINE ---
        function addWater(amount) {
            health.water = Math.min(3, health.water + amount);
            updateHealthUI();
        }
        function resetWater() { health.water = 0; updateHealthUI(); }
        function setSport(level) {
            health.sport = level;
            updateHealthUI();
        }
        function updateHealthUI() {
            localStorage.setItem('lifeos_v18_health', JSON.stringify(health));
            document.getElementById('waterCount').innerText = health.water;
            document.getElementById('waterBar').style.width = (health.water / 3 * 100) + "%";
            const sportTxt = ["Aucun effort", "Entretien", "Performance", "Ã‰lite"];
            document.getElementById('sportStatus').innerText = sportTxt[health.sport];
            ['s1','s2','s3'].forEach((id,idx) => {
                const el = document.getElementById(id);
                (idx+1) <= health.sport ? el.classList.add('bg-blue-500/30') : el.classList.remove('bg-blue-500/30');
            });
            buildCal();
        }

        // --- CALENDRIER & TASKS ---
        function buildCal() {
            const cal = document.getElementById('calendar'); cal.innerHTML = '';
            let total = 0, done = 0;
            for(let i=1; i<=31; i++) {
                const tasks = db[i] || [];
                const allDone = tasks.length > 0 && tasks.every(t => t.done);
                let alertClass = '';
                if(tasks.length > 0 && !allDone) {
                    if(i < todayNum) alertClass = 'alert-retard'; 
                    if(i === todayNum) alertClass = 'alert-today'; 
                }
                const d = document.createElement('div');
                d.className = `day ${alertClass} ${i === todayNum ? 'border-blue-500' : ''}`;
                d.innerText = i;
                if(tasks.length) {
                    const dot = document.createElement('div');
                    dot.className = `status-dot ${allDone ? 'bg-green-500' : 'bg-red-500'}`;
                    d.appendChild(dot);
                    total++; if(allDone) done++;
                }
                d.onclick = () => showDay(i);
                cal.appendChild(d);
            }
            // Score = TÃ¢ches + Eau + Sport
            const healthScore = (health.water / 3 * 15) + (health.sport * 5);
            const taskScore = total ? (done / total * 70) : 0;
            document.getElementById('score').innerText = Math.round(healthScore + taskScore) + "%";
        }

        function getShoppingLinks(text) {
            const t = text.toLowerCase();
            const shop = {
                'vitamine': ['Nutri&Co', 'https://nutriandco.com'],
                'protÃ©ine': ['Prozis', 'https://www.prozis.com'],
                'magnÃ©sium': ['Novoma', 'https://www.novoma.com']
            };
            for(let key in shop) {
                if(t.includes(key)) return `<div class="mt-1 text-[10px] text-blue-400 font-bold uppercase"><a href="${shop[key][1]}" target="_blank" class="underline">â†’ Acheter ${shop[key][0]}</a></div>`;
            }
            return "";
        }

        function showDay(day) {
            currentDayOpen = day;
            const tasks = db[day] || [];
            document.getElementById('modalDate').innerText = new Intl.DateTimeFormat('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' }).format(new Date(2025, 11, day));
            document.getElementById('taskList').innerHTML = tasks.length ? tasks.map((t, idx) => `
                <div class="flex flex-col p-6 bg-white/5 rounded-3xl border border-white/5 group">
                    <div class="flex items-center justify-between">
                        <input type="text" value="${t.text}" onchange="editTask(${day}, ${idx}, this.value)" class="bg-transparent outline-none w-full ${t.done ? 'line-through opacity-20' : 'opacity-90 font-semibold'}">
                        <div class="flex items-center gap-4">
                            <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${day}, ${idx})">
                            <button onclick="deleteTask(${day}, ${idx})" class="text-red-500 opacity-0 group-hover:opacity-100 text-sm">âœ•</button>
                        </div>
                    </div>
                    ${!t.done ? getShoppingLinks(t.text) : ""}
                </div>
            `).join('') : '<p class="text-center py-10 opacity-30 italic font-medium">Aucun objectif.</p>';
            document.getElementById('dayModal').classList.remove('hidden');
        }

        function addTaskManually() {
            const val = document.getElementById('newTaskInput').value;
            if(!val) return;
            db[currentDayOpen] = [...(db[currentDayOpen] || []), {text: val, done: false}];
            save(); document.getElementById('newTaskInput').value = '';
        }
        function editTask(d,i,t) { db[d][i].text = t; save(); }
        function deleteTask(d,i) { db[d].splice(i,1); save(); }
        function toggleTask(d,i) { db[d][i].done = !db[d][i].done; save(); }
        function save() { localStorage.setItem('lifeos_v18_db', JSON.stringify(db)); showDay(currentDayOpen); buildCal(); }
        function closeDay() { document.getElementById('dayModal').classList.add('hidden'); }

        // --- IA ENGINE ---
        async function traiter() {
            const input = document.getElementById('userInput').value;
            const btn = document.getElementById('btnMain');
            if(!input) return;
            btn.innerText = "STRATÃ‰GIE NEURALE..."; btn.disabled = true;

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            {role: "system", content: "Assistant Holistique. RÃ©ponds en JSON : { 'coach': 'conseil', 'yt_search': 'sujet youtube prÃ©cis', 'time': 'gain temps', 'prio': 'urgence', 'schedule': [{'day': 12, 'tasks':['...']}] }"},
                            {role: "user", content: input}
                        ]
                    })
                });
                const data = await response.json();
                let clean = data.choices[0].message.content.trim();
                if (clean.includes('{')) clean = clean.substring(clean.indexOf('{'), clean.lastIndexOf('}') + 1);
                const res = JSON.parse(clean);

                document.getElementById('coachCard').style.opacity = "1";
                document.getElementById('coachTxt').innerText = res.coach;
                document.getElementById('timeTip').innerText = res.time;
                document.getElementById('prioList').innerText = res.prio;
                
                if(res.yt_search) {
                    const ytBtn = document.getElementById('ytLink');
                    ytBtn.classList.remove('hidden');
                    ytBtn.href = `https://www.youtube.com/results?search_query=${encodeURIComponent(res.yt_search)}`;
                }

                res.schedule.forEach(s => { db[s.day] = [...(db[s.day] || []), ...s.tasks.map(t => ({text: t, done: false}))]; });
                localStorage.setItem('lifeos_v18_db', JSON.stringify(db));
                buildCal();
            } catch (e) { alert("Erreur IA"); }
            finally { btn.innerText = "Lancer l'Analyse Holistique"; btn.disabled = false; }
        }

        updateHealthUI();
    </script>
</body>
</html>
