<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>LifeOS Sovereign V21 - Aura Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #010101; color: #fff; -webkit-font-smoothing: antialiased; }
        
        .glass { border-radius: 2.5rem; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(60px); background: rgba(255,255,255,0.02); }
        .glass-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 1.5rem; transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1); }
        .glass-card:hover { background: rgba(255,255,255,0.06); border-color: rgba(59, 130, 246, 0.5); transform: translateY(-2px); box-shadow: 0 10px 30px -10px rgba(59, 130, 246, 0.2); }
        
        @keyframes strike { 0% { width: 0; } 100% { width: 100%; } }
        .strikethrough { position: relative; color: rgba(255,255,255,0.2); }
        .strikethrough::after { content: ''; position: absolute; left: 0; top: 50%; height: 1px; background: #3b82f6; animation: strike 0.3s ease-out forwards; }

        .btn-premium { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); transition: 0.3s; font-weight: 800; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); }
        .btn-premium:hover { filter: brightness(1.2); transform: scale(1.02); }

        .custom-check { appearance: none; width: 22px; height: 22px; border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; cursor: pointer; transition: 0.3s; position: relative; }
        .custom-check:checked { background: #3b82f6; border-color: #3b82f6; }
        .custom-check:checked::after { content: 'âœ“'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 12px; font-weight: bold; }
        
        .day { aspect-ratio: 1; border-radius: 1.2rem; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; background: rgba(255,255,255,0.02); }
        .day:hover { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .day-today { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2)); border: 1px solid #3b82f6 !important; font-weight: 800; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-[1400px] mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-4 space-y-6">
            <div class="glass p-10 space-y-8">
                <header>
                    <h1 class="text-5xl font-black italic tracking-tighter">LIFE<span class="text-blue-500">OS</span></h1>
                    <p id="clock" class="text-[10px] uppercase tracking-[0.4em] text-zinc-500 font-bold mt-4"></p>
                </header>

                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] font-black uppercase tracking-widest text-blue-400">Neural Input</span>
                        <button onclick="toggleVoice()" id="voiceBtn" class="text-xl hover:scale-125 transition-transform">ðŸŽ¤</button>
                    </div>
                    <textarea id="userInput" class="w-full bg-transparent outline-none text-2xl font-light min-h-[120px]" placeholder="Parlez Ã  votre systÃ¨me..."></textarea>
                    <button onclick="traiter()" id="btnMain" class="w-full btn-premium py-5 rounded-2xl uppercase text-[10px] tracking-[0.3em]">Analyser le flux</button>
                </div>

                <div class="grid grid-cols-2 gap-4 border-t border-white/5 pt-8">
                    <div class="text-center">
                        <p class="text-[8px] font-black opacity-30 uppercase">EfficacitÃ©</p>
                        <p id="score" class="text-3xl font-black text-blue-500 italic">0%</p>
                    </div>
                    <div class="text-center border-l border-white/5">
                        <p class="text-[8px] font-black opacity-30 uppercase">Hydratation</p>
                        <p class="text-3xl font-black text-cyan-400 italic"><span id="waterCount">0</span>L</p>
                    </div>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-8 glass p-10">
            <div class="flex justify-between items-center mb-10">
                <h2 id="currentMonth" class="text-2xl font-black tracking-tighter italic uppercase underline decoration-blue-500 underline-offset-8">Roadmap</h2>
                <div class="flex gap-4">
                    <button onclick="addWater(0.5)" class="glass px-6 py-2 text-[10px] font-black hover:bg-blue-600/20 transition-all">+ EAU</button>
                </div>
            </div>
            
            <div id="calendar" class="grid grid-cols-7 gap-4"></div>
            
            <div id="coachCard" class="mt-10 p-8 glass-card hidden">
                <div class="flex justify-between items-start">
                    <p id="coachTxt" class="text-sm italic opacity-80 leading-relaxed max-w-md"></p>
                    <a id="ytLink" target="_blank" class="hidden bg-red-600 px-4 py-2 rounded-xl text-[9px] font-black uppercase">Solution ðŸŽ¬</a>
                </div>
            </div>
        </main>
    </div>

    <div id="dayModal" class="hidden fixed inset-0 z-[150] flex items-center justify-center p-6 bg-black/95 backdrop-blur-3xl">
        <div class="glass p-12 max-w-2xl w-full space-y-10 relative overflow-hidden">
            <div class="flex justify-between items-center">
                <h2 id="modalDate" class="text-4xl font-black tracking-tighter italic text-blue-500 capitalize">Date</h2>
                <button onclick="closeDay()" class="text-3xl opacity-20 hover:opacity-100 transition-opacity">âœ•</button>
            </div>

            <div class="relative group">
                <input type="text" id="newTaskInput" placeholder="Ajouter une mission..." class="w-full bg-white/5 p-6 rounded-2xl outline-none border border-white/10 text-lg focus:border-blue-500/50 transition-all">
                <button onclick="addTaskManually()" class="absolute right-3 top-3 bg-blue-600 hover:bg-blue-500 w-12 h-12 rounded-xl font-black transition-all">+</button>
            </div>

            <div id="taskList" class="space-y-4 max-h-[450px] overflow-y-auto pr-4 custom-scroll"></div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('lifeos_v21_db') || "{}");
        let health = { water: 0, lastDate: new Date().toDateString() };
        const now = new Date();
        const todayNum = now.getDate();
        let currentDayOpen = null;

        document.getElementById('clock').innerText = new Intl.DateTimeFormat('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' }).format(now);
        document.getElementById('currentMonth').innerText = new Intl.DateTimeFormat('fr-FR', { month: 'long', year: 'numeric' }).format(now);

        function buildCal() {
            const cal = document.getElementById('calendar'); cal.innerHTML = '';
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            let total=0, done=0;

            for(let i=1; i<=daysInMonth; i++) {
                const tasks = db[i] || [];
                const allDone = tasks.length > 0 && tasks.every(t => t.done);
                const d = document.createElement('div');
                d.className = `day ${i === todayNum ? 'day-today' : ''}`;
                d.innerHTML = `<span>${i}</span>`;
                
                if(tasks.length) {
                    const dot = document.createElement('div');
                    dot.className = `w-1.5 h-1.5 rounded-full mt-1 ${allDone ? 'bg-green-500' : 'bg-red-500'}`;
                    d.appendChild(dot);
                    total++; if(allDone) done++;
                }
                d.onclick = () => showDay(i);
                cal.appendChild(d);
            }
            document.getElementById('score').innerText = total ? Math.round(done/total*100) + "%" : "0%";
        }

        function showDay(day) {
            currentDayOpen = day;
            const tasks = db[day] || [];
            document.getElementById('modalDate').innerText = `${day} ${new Intl.DateTimeFormat('fr-FR', { month: 'long' }).format(now)}`;
            
            document.getElementById('taskList').innerHTML = tasks.length ? tasks.map((t, idx) => `
                <div class="glass-card p-6 flex items-center justify-between group">
                    <div class="flex items-center gap-6 w-full">
                        <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${day}, ${idx})" class="custom-check">
                        <div class="flex flex-col">
                            <span class="text-lg font-bold transition-all ${t.done ? 'strikethrough opacity-30' : 'opacity-90'}">${t.text}</span>
                            ${!t.done && t.text.toLowerCase().includes('vitamine') ? '<span class="text-[9px] text-blue-400 font-black mt-1">ðŸ›’ RECOMMANDATION : NUTRI&CO</span>' : ''}
                        </div>
                    </div>
                    <button onclick="delTask(${day}, ${idx})" class="opacity-0 group-hover:opacity-100 text-red-500 p-2 hover:bg-red-500/10 rounded-lg transition-all">âœ•</button>
                </div>
            `).join('') : '<p class="text-center py-20 opacity-20 italic">Aucune mission pour aujourd\'hui.</p>';
            
            document.getElementById('dayModal').classList.remove('hidden');
        }

        function addTaskManually() {
            const val = document.getElementById('newTaskInput').value;
            if(!val) return;
            db[currentDayOpen] = [...(db[currentDayOpen] || []), {text: val, done: false}];
            save(); document.getElementById('newTaskInput').value = '';
        }

        function toggleTask(d, i) { db[d][i].done = !db[d][i].done; save(); }
        function delTask(d, i) { db[d].splice(i, 1); save(); }
        function save() { localStorage.setItem('lifeos_v21_db', JSON.stringify(db)); buildCal(); showDay(currentDayOpen); }
        function closeDay() { document.getElementById('dayModal').classList.add('hidden'); }
        function addWater(v) { health.water += v; document.getElementById('waterCount').innerText = health.water; }

        async function traiter() {
            const input = document.getElementById('userInput').value;
            if(!input) return;
            const btn = document.getElementById('btnMain');
            btn.innerText = "ALGORITHME..."; btn.disabled = true;
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{role: "system", content: "Expert. JSON STRICT: { 'coach': '...', 'yt_search': '...', 'schedule': [{'day': N, 'tasks':['...']}] }"}, {role: "user", content: input}]
                    })
                });
                const data = await response.json();
                const res = JSON.parse(data.choices[0].message.content.trim().match(/\{.*\}/s)[0]);
                document.getElementById('coachCard').classList.remove('hidden');
                document.getElementById('coachTxt').innerText = res.coach;
                if(res.yt_search) { document.getElementById('ytLink').classList.remove('hidden'); document.getElementById('ytLink').href = `https://youtube.com/results?search_query=${res.yt_search}`; }
                res.schedule.forEach(s => { db[s.day] = [...(db[s.day] || []), ...s.tasks.map(t => ({text: t, done: false}))]; });
                save();
            } catch (e) { alert("Erreur IA"); }
            finally { btn.innerText = "Analyser le flux"; btn.disabled = false; }
        }

        buildCal();
    </script>
</body>
</html>
