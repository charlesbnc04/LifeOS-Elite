<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOS V75 - God Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #030303; color: #fff; -webkit-font-smoothing: antialiased; min-height: 100vh; overflow-x: hidden; }
        
        /* BACKGROUND VIVANT */
        .god-bg { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 50% 0%, #1a1a40 0%, #000000 60%); }
        .grid-overlay { position: fixed; inset: 0; z-index: -1; background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px); background-size: 40px 40px; mask-image: linear-gradient(to bottom, black 40%, transparent 100%); }

        /* GLASSMORPHISM AVANC√â */
        .glass-panel { background: rgba(10, 10, 12, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 1.5rem; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5); }
        .glass-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 1rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .glass-card:hover { background: rgba(255, 255, 255, 0.06); transform: translateY(-2px); border-color: rgba(255, 255, 255, 0.15); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }

        /* TIMELINE */
        .timeline-container { position: relative; padding-left: 3rem; border-left: 2px solid rgba(255,255,255,0.05); margin-left: 1rem; }
        .timeline-node { position: absolute; left: -3.55rem; top: 1.5rem; width: 1rem; height: 1rem; border-radius: 50%; border: 2px solid #111; z-index: 10; transition: 0.3s; }
        .time-label { position: absolute; left: -7.5rem; top: 1.4rem; font-family: monospace; font-size: 0.8rem; color: #666; width: 3.5rem; text-align: right; }

        /* THEMES DYNAMIQUES */
        .theme-sport .timeline-node { background: #f97316; box-shadow: 0 0 15px rgba(249, 115, 22, 0.4); }
        .theme-focus .timeline-node { background: #8b5cf6; box-shadow: 0 0 15px rgba(139, 92, 246, 0.4); }
        .theme-diet .timeline-node { background: #10b981; box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }
        .theme-ai .timeline-node { background: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.6); border-color: white; }

        /* UI ELEMENTS */
        .neon-btn { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); position: relative; overflow: hidden; transition: 0.3s; }
        .neon-btn::after { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transform: skewX(-20deg); transition: 0.5s; }
        .neon-btn:hover::after { left: 150%; transition: 0.7s; }
        
        .ai-pulse { animation: aiPulse 2s infinite; }
        @keyframes aiPulse { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }

        .day-cell { aspect-ratio: 1; border-radius: 0.8rem; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.05); }
        .day-cell.active { background: #fff; color: #000; font-weight: 900; box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .day-cell.has-data { border-bottom: 2px solid #3b82f6; }

        /* LOADER */
        .thinking-matrix { display: flex; gap: 4px; align-items: center; justify-content: center; height: 20px; }
        .thinking-bar { width: 3px; background: #3b82f6; animation: think 1s ease-in-out infinite; }
        .thinking-bar:nth-child(2) { animation-delay: 0.1s; }
        .thinking-bar:nth-child(3) { animation-delay: 0.2s; }
        @keyframes think { 0%, 100% { height: 5px; opacity: 0.3; } 50% { height: 20px; opacity: 1; box-shadow: 0 0 10px #3b82f6; } }
    </style>
</head>
<body class="p-4 md:p-8 selection:bg-blue-500 selection:text-white">

    <div class="god-bg"></div>
    <div class="grid-overlay"></div>

    <div class="max-w-[1800px] mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6 relative">
        
        <aside class="lg:col-span-3 flex flex-col gap-6 h-fit lg:sticky lg:top-8">
            
            <div class="glass-panel p-6 flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-black tracking-tight">LIFE<span class="text-blue-500 italic">OS</span></h1>
                    <p class="text-[10px] font-mono text-zinc-500 uppercase tracking-widest">V75 SINGULARITY</p>
                </div>
                <button onclick="toggleConfig()" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition">‚öôÔ∏è</button>
            </div>

            <div class="glass-panel p-6">
                <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
            </div>

            <div class="glass-panel p-1 flex-1 flex flex-col relative group">
                <div class="absolute inset-0 bg-blue-600/5 blur-xl group-hover:bg-blue-600/10 transition duration-700 rounded-3xl"></div>
                <textarea id="userInput" class="w-full bg-transparent p-5 text-sm outline-none resize-none h-40 relative z-10 placeholder-zinc-600 font-medium" placeholder="Parle √† l'Architecte.&#10;Ex: 'Semaine charg√©e. Optimise mon sommeil et mes repas pour une r√©cup√©ration maximale.'"></textarea>
                
                <div class="p-2 relative z-10">
                    <button onclick="executeGodMode()" id="actionBtn" class="neon-btn w-full py-4 rounded-xl font-black text-xs uppercase tracking-[0.2em] flex items-center justify-center gap-3">
                        <span>Initialiser Optimisation</span>
                    </button>
                </div>

                <div id="aiOverlay" class="hidden absolute inset-0 z-20 bg-black/90 backdrop-blur-md rounded-2xl flex flex-col items-center justify-center gap-4">
                    <div class="thinking-matrix">
                        <div class="thinking-bar"></div><div class="thinking-bar"></div><div class="thinking-bar"></div>
                    </div>
                    <p class="text-[10px] font-mono text-blue-400 animate-pulse">ANALYSE BIOMETRIQUE EN COURS...</p>
                </div>
            </div>

            <div class="glass-panel p-6 flex items-center justify-between">
                <div>
                    <p class="text-[9px] font-bold uppercase text-zinc-500">Hydratation</p>
                    <p id="waterDisplay" class="text-2xl font-bold">0L</p>
                </div>
                <button onclick="addWater(0.25)" class="h-10 w-10 rounded-full border border-blue-500/30 text-blue-500 hover:bg-blue-500 hover:text-white transition flex items-center justify-center">+</button>
            </div>

        </aside>

        <main class="lg:col-span-9 space-y-6">
            
            <div class="glass-panel p-8 md:p-10 relative overflow-hidden">
                <div class="absolute top-0 right-0 p-32 bg-blue-600/10 blur-[100px] rounded-full pointer-events-none"></div>
                
                <div class="flex flex-col md:flex-row justify-between md:items-end gap-8 relative z-10">
                    <div class="space-y-2">
                        <div class="flex items-center gap-3">
                            <span id="systemStatus" class="w-2 h-2 rounded-full bg-green-500 ai-pulse"></span>
                            <span class="text-[10px] font-bold font-mono text-blue-400">ONLINE</span>
                        </div>
                        <h2 id="currentDateDisplay" class="text-5xl md:text-7xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-br from-white to-zinc-500">Aujourd'hui</h2>
                        <p id="aiStrategy" class="text-sm md:text-base text-zinc-400 max-w-2xl leading-relaxed italic border-l-2 border-blue-500/30 pl-4 mt-4">
                            "En attente de directives. Le syst√®me est pr√™t √† structurer votre r√©alit√©."
                        </p>
                    </div>

                    <div class="flex gap-4">
                        <div class="glass-card p-4 text-right min-w-[120px]">
                            <p class="text-[9px] font-bold uppercase text-zinc-500">Cible Jour</p>
                            <p id="tdeeDisplay" class="text-2xl font-mono font-bold">--</p>
                            <p class="text-[10px] text-zinc-600">kcal</p>
                        </div>
                        <div class="glass-card p-4 text-right min-w-[120px] border-blue-500/20 bg-blue-900/5">
                            <p class="text-[9px] font-bold uppercase text-blue-400">Bio-Stack</p>
                            <p id="stackDisplay" class="text-sm font-bold mt-1">--</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-panel p-8 md:p-12 min-h-[500px]">
                <h3 class="text-xs font-bold uppercase tracking-widest text-zinc-600 mb-12 pl-12">S√©quence Temporelle</h3>
                <div id="timelineFeed" class="timeline-container space-y-8">
                    </div>
            </div>

        </main>
    </div>

    <div id="configModal" class="hidden fixed inset-0 z-50 bg-black/90 backdrop-blur-xl flex items-center justify-center">
        <div class="glass-panel p-8 w-full max-w-md relative">
            <button onclick="toggleConfig()" class="absolute top-4 right-4 text-zinc-500 hover:text-white">‚úï</button>
            <h2 class="text-xl font-bold mb-6">Param√®tres Syst√®me</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold uppercase text-blue-400">Cl√© API OpenRouter</label>
                    <input type="password" id="apiKeyInput" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 mt-1 text-sm focus:border-blue-500 outline-none transition" placeholder="sk-or-v1-...">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-[10px] font-bold uppercase text-zinc-500">Poids (kg)</label><input type="number" id="weightInput" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 mt-1 text-sm text-center"></div>
                    <div><label class="text-[10px] font-bold uppercase text-zinc-500">Taille (cm)</label><input type="number" id="heightInput" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 mt-1 text-sm text-center"></div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-[10px] font-bold uppercase text-zinc-500">√Çge</label><input type="number" id="ageInput" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 mt-1 text-sm text-center"></div>
                    <div><label class="text-[10px] font-bold uppercase text-zinc-500">Sexe</label><select id="sexInput" class="w-full bg-black/30 border border-white/10 rounded-lg p-3 mt-1 text-sm text-center"><option value="male">Homme</option><option value="female">Femme</option></select></div>
                </div>

                <button onclick="saveConfig()" class="neon-btn w-full py-3 rounded-lg font-bold text-xs uppercase tracking-widest mt-4">Sauvegarder</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * LIFE OS V75 - GOD MODE CORE
         * Architecture: Local Storage + Generative AI (OpenRouter)
         */

        // --- STATE MANAGEMENT ---
        const State = {
            db: JSON.parse(localStorage.getItem('lifeos_v75_db') || "{}"),
            profile: JSON.parse(localStorage.getItem('lifeos_v75_profile') || '{"weight":75,"height":180,"age":25,"sex":"male","apiKey":""}'),
            health: JSON.parse(localStorage.getItem('lifeos_v75_health') || '{"water":0}'),
            selectedDate: new Date().toISOString().split('T')[0] // Format YYYY-MM-DD
        };

        const View = {
            calendar: document.getElementById('calendarGrid'),
            timeline: document.getElementById('timelineFeed'),
            dateDisplay: document.getElementById('currentDateDisplay'),
            strategy: document.getElementById('aiStrategy'),
            tdee: document.getElementById('tdeeDisplay'),
            stack: document.getElementById('stackDisplay'),
            water: document.getElementById('waterDisplay'),
            modal: document.getElementById('configModal')
        };

        // --- INITIALIZATION ---
        function init() {
            renderCalendar();
            renderDay();
            
            // Listeners
            document.getElementById('userInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); executeGodMode(); }
            });
        }

        // --- NEURAL ENGINE (THE BRAIN) ---
        async function executeGodMode() {
            const prompt = document.getElementById('userInput').value;
            if (!prompt.trim()) return;

            const apiKey = State.profile.apiKey;
            if (!apiKey) { alert("ERREUR: Cl√© API manquante. Allez dans les r√©glages."); return; }

            // UI LOADING STATE
            document.getElementById('aiOverlay').classList.remove('hidden');
            
            // CONTEXTE TEMPOREL (Ce que l'IA doit savoir)
            // On envoie les t√¢ches d'aujourd'hui et de demain pour qu'elle ait du contexte
            const todayKey = State.selectedDate;
            const contextData = {
                profile: State.profile,
                currentSchedule: State.db[todayKey] || [],
                userRequest: prompt,
                date: todayKey
            };

            const systemPrompt = `
                Tu es LIFE OS, une Superintelligence Artificielle d√©di√©e √† l'optimisation biologique et productive de l'utilisateur.
                
                TA MISSION :
                1. Analyser la demande de l'utilisateur et son profil biom√©trique.
                2. G√©n√©rer ou Modifier son emploi du temps pour la date : ${todayKey}.
                3. Calculer pr√©cis√©ment les besoins nutritionnels (TDEE) en fonction de l'activit√© g√©n√©r√©e.
                4. Cr√©er des repas sur-mesure (titre, ingr√©dients, macros) pour atteindre ces objectifs.
                5. Fournir une "Strat√©gie" (texte court et percutant) expliquant tes choix.

                FORMAT DE REPONSE ATTENDU (JSON STRICT SEULEMENT) :
                {
                    "strategy": "Une phrase philosophique et strat√©gique sur la journ√©e.",
                    "tdee_target": 2500,
                    "supplements": "Liste des compl√©ments (ex: Cr√©atine, Zinc...)",
                    "tasks": [
                        {
                            "time": "08:00",
                            "title": "Titre Court",
                            "description": "D√©tails pr√©cis ou recette compl√®te si c'est un repas (avec macros).",
                            "type": "sport|focus|meal|routine|social",
                            "duration": 60
                        }
                    ]
                }
                
                R√®gles :
                - Si c'est un repas, le "type" doit √™tre "meal". Mets les macros (P/G/L) dans la description.
                - Si c'est du sport, pr√©cise l'intensit√©.
                - Sois cr√©atif. Ne donne pas de plats g√©n√©riques. Invente des recettes optimis√©es.
            `;

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.href,
                    },
                    body: JSON.stringify({
                        "model": "openai/gpt-4o-mini", // Ou un mod√®le plus puissant si dispo
                        "messages": [
                            {"role": "system", "content": systemPrompt},
                            {"role": "user", "content": JSON.stringify(contextData)}
                        ],
                        "temperature": 0.7
                    })
                });

                const data = await response.json();
                let content = data.choices[0].message.content;
                content = content.replace(/```json|```/g, '').trim(); // Nettoyage
                
                const result = JSON.parse(content);
                
                // APPLICATION DES RESULTATS (Fusion intelligente)
                // On remplace ou on ajoute ? Pour cette version "God Mode", l'IA r√©√©crit la journ√©e pour l'optimiser.
                State.db[todayKey] = {
                    tasks: result.tasks,
                    meta: {
                        strategy: result.strategy,
                        tdee: result.tdee_target,
                        stack: result.supplements
                    }
                };

                saveState();
                renderDay();
                document.getElementById('userInput').value = '';

            } catch (error) {
                console.error(error);
                alert("Echec critique du noyau neuronal: " + error.message);
            } finally {
                document.getElementById('aiOverlay').classList.add('hidden');
            }
        }

        // --- RENDERING ENGINE ---
        function renderDay() {
            const dateKey = State.selectedDate;
            const data = State.db[dateKey] || { tasks: [], meta: { strategy: "Syst√®me en attente...", tdee: "--", stack: "--" } };
            
            // Update Header
            const dateObj = new Date(dateKey);
            View.dateDisplay.innerText = dateObj.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric' });
            View.strategy.innerText = `"${data.meta.strategy}"`;
            View.tdee.innerText = data.meta.tdee;
            View.stack.innerText = data.meta.stack;

            // Sort Tasks
            const sortedTasks = (data.tasks || []).sort((a, b) => {
                return a.time.localeCompare(b.time);
            });

            // Build Timeline
            View.timeline.innerHTML = sortedTasks.map((task, index) => {
                let themeClass = '';
                let icon = '';
                
                switch(task.type) {
                    case 'sport': themeClass = 'theme-sport'; icon = 'üî•'; break;
                    case 'focus': themeClass = 'theme-focus'; icon = 'üß†'; break;
                    case 'meal': themeClass = 'theme-diet'; icon = 'ü•ó'; break;
                    case 'social': themeClass = 'theme-ai'; icon = 'üë•'; break;
                    default: themeClass = 'theme-ai'; icon = '‚ö°';
                }

                // AI Generated Card
                return `
                    <div class="timeline-row ${themeClass} flex gap-6 relative animate-fade-in" style="animation-delay: ${index * 0.1}s">
                        <div class="time-label">${task.time}</div>
                        <div class="timeline-node"></div>
                        
                        <div class="glass-card p-5 flex-1 cursor-pointer group hover:border-blue-500/30">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center gap-3">
                                    <span class="text-xl opacity-80">${icon}</span>
                                    <h4 class="font-bold text-lg leading-none">${task.title}</h4>
                                </div>
                                <span class="text-[10px] font-mono opacity-40 uppercase border border-white/10 px-2 py-1 rounded">${task.type}</span>
                            </div>
                            <p class="text-sm text-zinc-400 font-medium leading-relaxed">${task.description}</p>
                            
                            ${task.type === 'meal' ? 
                                `<button onclick="window.open('https://www.google.com/search?q=recette+${encodeURIComponent(task.title)}','_blank')" class="mt-3 text-[10px] font-bold text-green-400 hover:text-green-300 uppercase tracking-wider flex items-center gap-1">‚ñ∂ Cuisiner</button>` : ''
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCalendar() {
            View.calendar.innerHTML = '';
            const today = new Date();
            // Affiche 7 jours centr√©s sur aujourd'hui ou la date s√©lect
            for (let i = 0; i < 7; i++) {
                const d = new Date();
                d.setDate(today.getDate() + i);
                const dateStr = d.toISOString().split('T')[0];
                const dayName = d.toLocaleDateString('fr-FR', { weekday: 'short' });
                const dayNum = d.getDate();

                const el = document.createElement('div');
                let classes = "day-cell flex flex-col gap-1";
                if (dateStr === State.selectedDate) classes += " active";
                if (State.db[dateStr]) classes += " has-data";
                
                el.className = classes;
                el.innerHTML = `<span class="opacity-50 text-[9px] uppercase">${dayName}</span><span class="font-bold text-lg">${dayNum}</span>`;
                el.onclick = () => {
                    State.selectedDate = dateStr;
                    renderCalendar(); // Re-render pour la class active
                    renderDay();
                };
                View.calendar.appendChild(el);
            }
        }

        // --- UTILS ---
        function saveState() {
            localStorage.setItem('lifeos_v75_db', JSON.stringify(State.db));
            localStorage.setItem('lifeos_v75_profile', JSON.stringify(State.profile));
            localStorage.setItem('lifeos_v75_health', JSON.stringify(State.health));
        }

        function toggleConfig() {
            View.modal.classList.toggle('hidden');
            if(!View.modal.classList.contains('hidden')) {
                // Load values
                document.getElementById('apiKeyInput').value = State.profile.apiKey || '';
                document.getElementById('weightInput').value = State.profile.weight;
                document.getElementById('heightInput').value = State.profile.height;
                document.getElementById('ageInput').value = State.profile.age;
                document.getElementById('sexInput').value = State.profile.sex;
            }
        }

        function saveConfig() {
            State.profile.apiKey = document.getElementById('apiKeyInput').value;
            State.profile.weight = document.getElementById('weightInput').value;
            State.profile.height = document.getElementById('heightInput').value;
            State.profile.age = document.getElementById('ageInput').value;
            State.profile.sex = document.getElementById('sexInput').value;
            saveState();
            toggleConfig();
            alert("Syst√®me mis √† jour.");
        }

        function addWater(amount) {
            State.health.water = (parseFloat(State.health.water) + amount).toFixed(2);
            document.getElementById('waterDisplay').innerText = State.health.water + 'L';
            saveState();
        }

        // Start System
        init();

    </script>
</body>
</html>
