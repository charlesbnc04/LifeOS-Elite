<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOS Sovereign V37 - Fluid Dynamics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #050505;
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            color: #fff; 
            -webkit-font-smoothing: antialiased; 
            min-height: 100vh;
            overflow-y: auto; /* SCROLL D√âBLOQU√â */
        }
        
        .glass-base {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border-radius: 2rem;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 1.5rem;
            transition: all 0.3s ease;
        }
        .glass-card:hover { background: rgba(255, 255, 255, 0.05); transform: translateY(-2px); border-color: rgba(255, 255, 255, 0.1); }

        .primary-btn { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); transition: 0.3s; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4); }
        .primary-btn:hover { transform: scale(1.02); }

        /* Calendar */
        .day { aspect-ratio: 1; border-radius: 0.8rem; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; transition: 0.2s; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); }
        .day:hover { background: rgba(255,255,255,0.1); border-color: white; }
        .day-today { color: #60a5fa; font-weight: 800; border-color: #60a5fa; }
        .day-selected { background: white !important; color: black !important; font-weight: 900; transform: scale(1.1); box-shadow: 0 0 15px rgba(255,255,255,0.3); }
        .has-event { border-bottom: 2px solid #a855f7; }

        .platform-icon { filter: grayscale(100%); opacity: 0.4; transition: 0.3s; }
        .platform-icon.active { filter: grayscale(0%); opacity: 1; transform: scale(1.1); box-shadow: 0 0 15px rgba(255,255,255,0.2); }
        
        /* Animation flash pour feedback */
        @keyframes highlight { 0% { background-color: rgba(59, 130, 246, 0.3); } 100% { background-color: transparent; } }
        .updated-flash { animation: highlight 1s ease-out; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-[1600px] mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-3 flex flex-col gap-6">
            
            <div class="glass-base p-8 space-y-6">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold tracking-tight">Life<span class="text-blue-500 italic">OS</span></h1>
                    <button onclick="openProfile()" class="text-[10px] font-bold bg-white/10 px-3 py-1.5 rounded-full hover:bg-white/20 transition-all">‚öôÔ∏è PARAM√àTRES</button>
                </div>

                <div>
                    <p class="text-[9px] font-bold uppercase tracking-widest text-zinc-500 mb-3">Audio Source</p>
                    <div class="flex gap-3">
                        <button onclick="setMusic('spotify')" id="btn-spotify" class="platform-icon w-10 h-10 rounded-xl bg-black/20 flex items-center justify-center border border-white/5"><svg class="w-5 h-5 text-[#1db954]" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg></button>
                        <button onclick="setMusic('deezer')" id="btn-deezer" class="platform-icon w-10 h-10 rounded-xl bg-black/20 flex items-center justify-center border border-white/5"><svg class="w-5 h-5 text-[#a238ff]" fill="currentColor" viewBox="0 0 24 24"><path d="M10.5 4v9h3V4h-3zm-5.2 5v4h3V9h-3zm10.4 2v10h3V11h-3zm-5.2 3v7h3V14h-3zm-5.2 2v5h3V16h-3z"/></svg></button>
                        <button onclick="setMusic('apple')" id="btn-apple" class="platform-icon w-10 h-10 rounded-xl bg-black/20 flex items-center justify-center border border-white/5"><svg class="w-5 h-5 text-[#fa2d48]" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm4.562 16.594c-.281.188-.844.563-1.688.563-1.688 0-2.344-1.313-2.344-2.813V9.375h-2.25v6.563c0 2.531 1.594 3.938 3.938 3.938 1.125 0 2.063-.563 2.344-.75v-2.532zM12.531 6c.844 0 1.5.656 1.5 1.5s-.656 1.5-1.5 1.5-1.5-.656-1.5-1.5.656-1.5 1.5-1.5z"/></svg></button>
                    </div>
                </div>

                <div>
                    <p class="text-[9px] font-bold uppercase tracking-widest text-zinc-500 mb-2">Ajout Intelligent</p>
                    <textarea id="userInput" class="w-full bg-black/20 border border-white/5 rounded-2xl p-4 text-sm outline-none resize-none focus:border-blue-500/50 transition-colors h-24" placeholder="Ex: Crossfit ce soir, Resto demain..."></textarea>
                    <button onclick="traiter()" class="primary-btn w-full mt-3 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest">Injecter & Calculer</button>
                </div>
                
                <div>
                     <p class="text-[9px] font-bold uppercase tracking-widest text-zinc-500 mb-2">Navigateur</p>
                     <div id="calendar" class="grid grid-cols-7 gap-1"></div>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-9 space-y-6 pb-10">
            
            <div id="main-hud" class="glass-base p-8 md:p-10 transition-colors duration-500">
                
                <div class="flex flex-col md:flex-row justify-between md:items-end mb-10 pb-6 border-b border-white/5 gap-6">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span id="dayIndicator" class="w-2 h-2 rounded-full bg-blue-500"></span>
                            <span id="hudStatus" class="text-[10px] font-bold uppercase tracking-widest opacity-60">Planning</span>
                        </div>
                        <h2 id="hudDate" class="text-4xl md:text-6xl font-black tracking-tight text-white">Date</h2>
                        <p id="contextBadge" class="mt-2 text-xl font-bold text-zinc-500">Standard</p>
                    </div>
                    
                    <div class="flex gap-8 text-right bg-black/20 p-4 rounded-2xl border border-white/5">
                        <div>
                            <p class="text-[9px] font-bold uppercase text-zinc-500 mb-1">Cible (TDEE)</p>
                            <p id="calTarget" class="text-2xl font-mono font-medium text-white">--</p>
                        </div>
                        <div>
                            <p class="text-[9px] font-bold uppercase text-zinc-500 mb-1">Impact Sport</p>
                            <p id="sportImpact" class="text-2xl font-black italic text-zinc-600">--</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-6">

                    <div class="glass-card p-0 flex flex-col md:flex-row overflow-hidden relative">
                        <div id="lunchColorBar" class="w-full md:w-2 bg-blue-500 h-2 md:h-auto"></div>
                        <div class="p-6 flex-1">
                            <div class="flex justify-between mb-2">
                                <p class="text-[10px] font-bold uppercase text-blue-400">D√©jeuner (12:30)</p>
                                <span id="lunchKcal" class="text-[10px] font-mono opacity-40">-- kcal</span>
                            </div>
                            <p id="hudLunch" class="text-lg font-medium mb-3">--</p>
                            <div id="lunchTags" class="flex gap-2"></div>
                        </div>
                    </div>

                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-4">
                            <p class="text-xs font-bold uppercase opacity-40 tracking-widest">Missions & Activit√©s</p>
                            <button id="musicContextBtn" class="hidden text-[10px] font-bold bg-white/10 px-3 py-1.5 rounded-lg hover:bg-white/20 transition-all flex items-center gap-2">
                                <span>‚ñ∂</span> Lancer Playlist
                            </button>
                        </div>
                        <div id="hudTasks" class="space-y-2"></div>
                    </div>

                    <div class="glass-card p-0 flex flex-col md:flex-row overflow-hidden relative">
                        <div id="dinnerColorBar" class="w-full md:w-2 bg-purple-500 h-2 md:h-auto"></div>
                        <div class="p-6 flex-1">
                            <div class="flex justify-between mb-2">
                                <p class="text-[10px] font-bold uppercase text-purple-400">D√Æner (20:00)</p>
                                <span id="dinnerKcal" class="text-[10px] font-mono opacity-40">-- kcal</span>
                            </div>
                            <p id="hudDinner" class="text-lg font-medium mb-3">--</p>
                            <div id="dinnerTags" class="flex gap-2"></div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="glass-card p-6">
                            <p class="text-[9px] font-bold uppercase text-indigo-400 mb-2">Routine Soir</p>
                            <p id="hudRoutineE" class="text-sm font-medium">--</p>
                        </div>
                        <div class="glass-card p-6 flex justify-between items-center cursor-pointer hover:bg-blue-900/10 transition-colors" onclick="addWater(0.5)">
                            <div>
                                <p class="text-[9px] font-bold uppercase text-blue-400 mb-1">Hydratation</p>
                                <p id="waterText" class="text-2xl font-black">0L</p>
                            </div>
                            <button class="bg-blue-600 w-10 h-10 rounded-full font-bold text-lg">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="profileModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md">
        <div class="glass-base p-8 max-w-sm w-full">
            <h2 class="text-xl font-bold mb-6 text-center">Profil M√©tabolique</h2>
            <div class="space-y-3 mb-6">
                <input type="number" id="inputWeight" class="w-full bg-white/10 p-4 rounded-xl text-center outline-none" placeholder="Poids (kg)">
                <input type="number" id="inputHeight" class="w-full bg-white/10 p-4 rounded-xl text-center outline-none" placeholder="Taille (cm)">
                <input type="number" id="inputAge" class="w-full bg-white/10 p-4 rounded-xl text-center outline-none" placeholder="√Çge">
                <select id="inputSex" class="w-full bg-white/10 p-4 rounded-xl text-center outline-none text-black">
                    <option value="male">Homme</option>
                    <option value="female">Femme</option>
                </select>
            </div>
            <button onclick="saveProfile()" class="primary-btn w-full py-4 rounded-xl font-bold">Sauvegarder & Recalculer</button>
        </div>
    </div>

    <script>
        // --- DATA INIT ---
        let db = JSON.parse(localStorage.getItem('lifeos_v37_db') || "{}");
        let profile = JSON.parse(localStorage.getItem('lifeos_v37_profile') || '{"weight":85, "height":185, "age":30, "sex":"male"}');
        let health = JSON.parse(localStorage.getItem('lifeos_v37_health') || '{"water":0}');
        let musicProvider = localStorage.getItem('lifeos_music') || 'spotify';
        
        const now = new Date();
        const todayNum = now.getDate();
        const currentMonth = now.getMonth();
        const monthNames = ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"];
        
        let selectedDay = todayNum;

        // --- DATABASE CULINAIRE √âTENDUE (ROTATION INFINIE) ---
        const mealsDB = {
            sport: {
                lunch: ["200g P√¢tes Compl√®tes + 180g Poulet + Courgettes", "250g Riz Basmati + 2 Steaks Hach√©s 5%", "Grand Wrap Thon/Ma√Øs/Oeuf (x2)", "300g Patate Douce + Dinde + Haricots", "Risotto Poulet Champignons", "Sandwich Club Complet Poulet", "Bowl √ânergie: Riz/Avocat/Saumon"],
                dinner: ["Omelette (4 oeufs) + 300g Pommes de terre", "300g Cabillaud + Pur√©e Maison", "Wok Poulet Nouilles", "Chili Con Carne + Riz", "Pizza Maison (P√¢te fine) + Salade", "Burger Maison (Pain Complet)", "Curry de Poulet + Riz"]
            },
            focus: {
                lunch: ["150g Saumon + 100g Quinoa + √âpinards", "Salade C√©sar (Poulet/Parmesan/Cro√ªtons)", "Maquereau Grill√© + Salade de Tomates", "Bowl Tofu Fum√© + Avocat", "Carpaccio Boeuf + Roquette", "Sushi (12 pi√®ces) + Salade Chou", "Tartare de Saumon + Avocat"],
                dinner: ["Soupe de L√©gumes + 150g Fromage Blanc", "Filet de Dinde + Haricots Verts", "Oeufs Brouill√©s + √âpinards", "Sardines Grill√©es + Salade", "Velout√© Potiron + Jambon", "Salade Grecque (Feta/Olives)", "Wok de L√©gumes + Tofu"]
            },
            std: {
                lunch: ["120g R√¥ti de Porc + Petits Pois", "Couscous Royal (Semoule moyenne)", "Lasagnes aux L√©gumes + Salade", "Hachis Parmentier + Salade", "Wrap Poulet Curry", "Taboul√© Libanais + Brochettes", "Quiche Lorraine + Salade"],
                dinner: ["Gratin Chou-fleur + Jambon", "Salade Compos√©e (Thon/Oeuf)", "Ratatouille + Riz Complet", "Po√™l√©e Foresti√®re + Omelette", "Soupe Miso + Sashimi", "Croque-Monsieur Complet", "Curry de L√©gumes"]
            }
        };

        // --- MOTEUR DE CALCUL CALORIQUE (CORRIG√â) ---
        function calculateTDEE(isSport) {
            // Mifflin-St Jeor corrig√© pour actif
            let bmr = (10 * profile.weight) + (6.25 * profile.height) - (5 * profile.age) + (profile.sex==='male'?5:-161);
            
            // Multiplicateur : Si sport, on passe en mode ATHL√àTE (x1.7) sinon Actif (x1.35)
            // On ne laisse jamais en s√©dentaire car LifeOS incite √† bouger.
            let activity = isSport ? 1.75 : 1.35; 
            
            return Math.round(bmr * activity);
        }

        // --- UI RENDERER (HUD) ---
        function renderHUD() {
            // Setup Context
            const isToday = (selectedDay === todayNum);
            const tasks = db[selectedDay] || [];
            const txt = tasks.map(t => t.text.toLowerCase()).join(' ');
            
            // D√©tection de mots cl√©s √©tendue
            const isSport = txt.includes('sport') || txt.includes('crossfit') || txt.includes('gym') || txt.includes('foot') || txt.includes('boxe') || txt.includes('match');
            const isFocus = txt.includes('bureau') || txt.includes('projet') || txt.includes('code') || txt.includes('r√©union');

            // Header Update
            document.getElementById('hudDate').innerText = `${selectedDay} ${monthNames[currentMonth]}`;
            document.getElementById('hudStatus').innerText = isToday ? "En Direct" : "Projection";
            document.getElementById('dayIndicator').className = isToday ? "w-2 h-2 rounded-full bg-green-500 animate-pulse" : "w-2 h-2 rounded-full bg-blue-500";
            
            // Context Badge Update
            const ctxBadge = document.getElementById('contextBadge');
            const impactDisplay = document.getElementById('sportImpact');
            
            if(isSport) {
                ctxBadge.innerText = "‚ö° PERFORMANCE DAY"; ctxBadge.className = "mt-2 text-xl font-black text-orange-500";
                impactDisplay.innerText = "√âLEV√â"; impactDisplay.className = "text-2xl font-black italic text-orange-500";
            } else if(isFocus) {
                ctxBadge.innerText = "üß† DEEP WORK"; ctxBadge.className = "mt-2 text-xl font-black text-purple-500";
                impactDisplay.innerText = "MOD√âR√â"; impactDisplay.className = "text-2xl font-black italic text-zinc-500";
            } else {
                ctxBadge.innerText = "‚öñÔ∏è √âQUILIBRE"; ctxBadge.className = "mt-2 text-xl font-black text-blue-500";
                impactDisplay.innerText = "BAS"; impactDisplay.className = "text-2xl font-black italic text-zinc-500";
            }

            // CALORIE CALCULATION
            const tdee = calculateTDEE(isSport);
            document.getElementById('calTarget').innerText = `${tdee} kcal`;

            // MEAL SELECTION (Rotation Infinie)
            // On utilise (Jour + Mois) pour varier d'un mois √† l'autre
            const rotationIndex = (selectedDay + currentMonth) % 7; 
            
            let mealType = 'std';
            if(isSport) mealType = 'sport';
            else if(isFocus) mealType = 'focus';

            const lunchMenu = mealsDB[mealType].lunch[rotationIndex];
            const dinnerMenu = mealsDB[mealType].dinner[rotationIndex];

            // Render Meals
            document.getElementById('hudLunch').innerText = lunchMenu;
            document.getElementById('lunchKcal').innerText = `${Math.round(tdee*0.4)} kcal`;
            document.getElementById('lunchColorBar').className = isSport ? "w-full md:w-2 bg-orange-500 h-2 md:h-auto" : "w-full md:w-2 bg-blue-500 h-2 md:h-auto";
            document.getElementById('lunchTags').innerHTML = isSport 
                ? `<span class="px-2 py-0.5 rounded text-[9px] font-bold bg-orange-500/20 text-orange-500">GLUCIDES++</span>`
                : `<span class="px-2 py-0.5 rounded text-[9px] font-bold bg-blue-500/20 text-blue-500">√âQUILIBR√â</span>`;

            document.getElementById('hudDinner').innerText = dinnerMenu;
            document.getElementById('dinnerKcal').innerText = `${Math.round(tdee*0.35)} kcal`;
            document.getElementById('dinnerColorBar').className = isSport ? "w-full md:w-2 bg-purple-500 h-2 md:h-auto" : "w-full md:w-2 bg-indigo-500 h-2 md:h-auto";

            // Music Context
            const mBtn = document.getElementById('musicContextBtn');
            if(isSport) {
                mBtn.classList.remove('hidden'); mBtn.innerHTML = `<span>‚ñ∂</span> Lancer "Beast Mode"`;
                mBtn.onclick = () => window.open(getLink('sport'), '_blank');
            } else if(isFocus) {
                mBtn.classList.remove('hidden'); mBtn.innerHTML = `<span>‚ñ∂</span> Lancer "Deep Focus"`;
                mBtn.onclick = () => window.open(getLink('focus'), '_blank');
            } else {
                mBtn.classList.add('hidden');
            }

            // Routine Update
            const rE = ["Lecture (20min)", "M√©ditation (10min)", "√âtirements Dos", "Journaling", "Respiration Box", "Massage Rouleau", "Aucun √©cran 30min"];
            document.getElementById('hudRoutineE').innerText = rE[(selectedDay+currentMonth) % rE.length];

            // Tasks Rendering
            const tBox = document.getElementById('hudTasks');
            if(tasks.length) {
                tBox.innerHTML = tasks.map((t, i) => `
                    <div class="glass-card p-4 flex items-center gap-4 group hover:bg-white/5 transition-colors">
                        <input type="checkbox" ${t.done?'checked':''} onchange="toggleTask(${selectedDay}, ${i})" class="w-5 h-5 rounded border border-white/20 bg-transparent checked:bg-blue-500 appearance-none cursor-pointer">
                        <span class="${t.done?'line-through opacity-30':'font-medium text-sm'}">${t.text}</span>
                        <button onclick="delTask(${selectedDay},${i})" class="ml-auto text-[10px] font-bold text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">‚úï</button>
                    </div>
                `).join('');
            } else {
                tBox.innerHTML = `<div class="p-6 text-center border border-dashed border-white/10 rounded-2xl"><p class="text-sm opacity-30 italic">Repos total planifi√©.</p></div>`;
            }

            // Flash Animation
            const main = document.getElementById('main-hud');
            main.classList.remove('updated-flash');
            void main.offsetWidth; // trigger reflow
            main.classList.add('updated-flash');
        }

        // --- LINK & UTILS ---
        function getLink(type) {
            let q = type==='sport' ? "Workout Phonk" : "Deep Focus";
            if(musicProvider==='spotify') return `https://open.spotify.com/search/${encodeURIComponent(q)}`;
            if(musicProvider==='deezer') return `https://www.deezer.com/search/${encodeURIComponent(q)}`;
            return `https://music.apple.com/us/search?term=${encodeURIComponent(q)}`;
        }

        function renderCal() {
            const cal = document.getElementById('calendar'); cal.innerHTML='';
            const max = new Date(now.getFullYear(), now.getMonth()+1, 0).getDate();
            for(let i=1; i<=max; i++) {
                const d = document.createElement('div');
                let c = "day";
                if(i===todayNum) c += " day-today";
                if(i===selectedDay) c += " day-selected";
                if(db[i] && db[i].length) c += " has-event";
                d.className = c; d.innerText = i;
                d.onclick = () => { selectedDay=i; renderCal(); renderHUD(); };
                cal.appendChild(d);
            }
        }

        function traiter() {
            const raw = document.getElementById('userInput').value; if(!raw.trim()) return;
            // Logique : Si l'utilisateur est sur le jour 28 et tape "sport", √ßa va sur le 28.
            // S'il tape "Sport demain", √ßa va sur le 29.
            let d = selectedDay;
            if(raw.toLowerCase().includes('demain')) d = todayNum + 1;
            else if(raw.toLowerCase().includes('le ')) {
                 const m = raw.toLowerCase().match(/le (\d{1,2})/);
                 if(m) d = parseInt(m[1]);
            }
            
            const cl = raw.replace(/demain|le \d{1,2}/gi,'').trim();
            db[d] = [...(db[d]||[]), {text:cl, done:false}];
            
            save(); 
            document.getElementById('userInput').value='';
            
            // Si on a modifi√© le jour qu'on regarde, on refresh le HUD
            if(d === selectedDay) renderHUD();
            else {
                // Feedback visuel si on a ajout√© ailleurs
                alert(`T√¢che ajout√©e au jour ${d}`);
            }
        }

        function toggleTask(d,i){db[d][i].done=!db[d][i].done; save();}
        function delTask(d,i){db[d].splice(i,1); save();}
        function addWater(n){health.water+=n; save(); document.getElementById('waterText').innerText=health.water+'L'; document.getElementById('waterBar').style.width=Math.min(100,health.water/2.5*100)+'%';}
        function save(){localStorage.setItem('lifeos_v37_db',JSON.stringify(db)); localStorage.setItem('lifeos_v37_profile',JSON.stringify(profile)); localStorage.setItem('lifeos_v37_health',JSON.stringify(health)); localStorage.setItem('lifeos_music',musicProvider); renderCal(); renderHUD();}
        function setMusic(p){musicProvider=p; updateMusicUI(); save();}
        function updateMusicUI(){ ['spotify','deezer','apple'].forEach(p=>document.getElementById(`btn-${p}`).classList.remove('active')); document.getElementById(`btn-${musicProvider}`).classList.add('active'); }
        function openProfile(){document.getElementById('profileModal').classList.remove('hidden');}
        function saveProfile(){ 
            profile.weight=document.getElementById('inputWeight').value||85; 
            profile.height=document.getElementById('inputHeight').value||185; 
            profile.age=document.getElementById('inputAge').value||30; 
            profile.sex=document.getElementById('inputSex').value; 
            document.getElementById('profileModal').classList.add('hidden'); save();
        }

        // Init
        document.getElementById('userInput').addEventListener('keypress', (e)=>{if(e.key==='Enter')traiter()});
        document.getElementById('inputWeight').value = profile.weight;
        document.getElementById('inputHeight').value = profile.height;
        document.getElementById('inputAge').value = profile.age;
        updateMusicUI(); renderCal(); renderHUD();
    </script>
</body>
</html>
