<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>LifeOS Sovereign V22 - Aura Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #010101; color: #fff; -webkit-font-smoothing: antialiased; overflow-x: hidden; }
        
        /* Glassmorphism am√©lior√© */
        .glass { border-radius: 2.5rem; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(50px); background: rgba(255,255,255,0.02); }
        .glass-dark { border-radius: 2rem; background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.08); }
        
        /* Modern To-Do Cards */
        .task-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 1.5rem; transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .task-card:hover { transform: translateY(-3px); background: rgba(59, 130, 246, 0.05); border-color: rgba(59, 130, 246, 0.3); }
        
        .day { aspect-ratio: 1; border-radius: 1.2rem; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; transition: 0.4s; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); }
        .day:hover { transform: scale(1.1); background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; }
        .day-today { border: 2px solid #3b82f6 !important; background: rgba(59, 130, 246, 0.05); font-weight: 800; }
        
        /* Custom Inputs */
        .aura-input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 1.2rem; padding: 1.2rem; outline: none; transition: 0.3s; width: 100%; }
        .aura-input:focus { border-color: #3b82f6; box-shadow: 0 0 20px rgba(59, 130, 246, 0.1); }

        .water-progress { transition: width 0.8s cubic-bezier(0.65, 0, 0.35, 1); background: linear-gradient(90deg, #3b82f6, #06b6d4); }
        
        /* Strikethrough Animation */
        .strikethrough { position: relative; color: rgba(255,255,255,0.2); transition: 0.3s; }
        .strikethrough::after { content: ''; position: absolute; left: 0; top: 55%; width: 100%; height: 1.5px; background: #3b82f6; transform-origin: left; animation: strike 0.3s ease-out; }
        @keyframes strike { from { transform: scaleX(0); } to { transform: scaleX(1); } }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-[1600px] mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-3 space-y-6">
            <div class="glass p-8 space-y-8">
                <div>
                    <h1 class="text-4xl font-black italic tracking-tighter uppercase">LIFE<span class="text-blue-500">OS</span></h1>
                    <p id="clock" class="text-[10px] uppercase tracking-[0.4em] text-zinc-500 font-bold mt-2"></p>
                </div>

                <div class="space-y-4 pt-4 border-t border-white/5">
                    <h3 class="text-[9px] font-black uppercase tracking-widest text-purple-400 italic">Recovery & Sleep</h3>
                    <div class="glass-dark p-5 space-y-2">
                        <p class="text-[10px] opacity-40 font-bold">R√©veil Id√©al</p>
                        <p id="sleepAdvice" class="text-xl font-black italic">07:30</p>
                    </div>
                </div>
            </div>

            <div class="glass p-8 space-y-6">
                <div class="flex justify-between items-end">
                    <h3 class="text-[9px] font-black uppercase text-zinc-500 tracking-widest italic">Vitalit√©</h3>
                    <span id="score" class="text-4xl font-black italic text-blue-500">0%</span>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center text-[10px] font-bold">
                        <span>EAU</span>
                        <span class="text-blue-400"><span id="waterCount">0</span>L/3L</span>
                    </div>
                    <div class="h-2 w-full bg-white/5 rounded-full overflow-hidden"><div id="waterBar" class="water-progress h-full w-0"></div></div>
                    <button onclick="addWater(0.5)" class="w-full py-4 glass-dark text-[10px] font-black hover:bg-blue-600/20 transition-all uppercase tracking-widest">+ 0.5 Litres</button>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-5 space-y-6">
            <div class="glass p-10 relative overflow-hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-blue-500 font-bold text-[10px] uppercase tracking-[0.3em] italic">Neural Engine V22</h2>
                    <button onclick="toggleVoice()" id="voiceBtn" class="w-12 h-12 glass rounded-full flex items-center justify-center hover:scale-110 transition-all">üé§</button>
                </div>
                <textarea id="userInput" class="w-full bg-transparent outline-none text-2xl font-light mb-8 placeholder:opacity-10 min-h-[140px]" placeholder="Dict√©e libre..."></textarea>
                <button onclick="traiter()" id="btnMain" class="w-full bg-blue-600 hover:bg-blue-500 py-6 rounded-3xl uppercase text-[11px] font-black tracking-[0.4em] transition-all shadow-xl shadow-blue-900/40">Analyser le flux</button>
            </div>

            <div id="coachCard" class="glass p-8 opacity-40">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-purple-500 font-black text-[10px] uppercase italic tracking-widest">Diagnostic IA</h3>
                    <a id="ytLink" target="_blank" class="hidden bg-red-600 text-[9px] font-black px-4 py-1.5 rounded-lg uppercase">Vid√©o Solution üé¨</a>
                </div>
                <p id="coachTxt" class="text-sm italic opacity-80 leading-relaxed"></p>
            </div>
        </main>

        <section class="lg:col-span-4 glass p-10 space-y-8">
            <h2 id="currentMonth" class="font-black text-2xl tracking-tighter italic uppercase underline decoration-blue-500 decoration-4 underline-offset-8">Roadmap</h2>
            <div id="calendar" class="grid grid-cols-7 gap-3"></div>
            
            <div class="pt-8 border-t border-white/5 space-y-4">
                <h4 class="text-red-500 font-black text-[9px] uppercase tracking-widest italic">Urgences</h4>
                <div id="prioList" class="text-xs font-bold italic opacity-40">Aucun conflit d√©tect√©.</div>
            </div>
        </section>
    </div>

    <div id="dayModal" class="hidden fixed inset-0 z-[150] flex items-center justify-center p-6 bg-black/90 backdrop-blur-3xl">
        <div class="glass p-12 max-w-xl w-full space-y-8 relative border-white/10 shadow-2xl">
            <div class="flex justify-between items-center">
                <h2 id="modalDate" class="text-4xl font-black tracking-tighter italic text-blue-500 capitalize">Date</h2>
                <button onclick="closeDay()" class="text-zinc-600 hover:text-white text-2xl transition-all">‚úï</button>
            </div>
            
            <div class="relative">
                <input type="text" id="newTaskInput" placeholder="Assigner une mission..." class="aura-input font-medium text-sm">
                <button onclick="addTaskManually()" class="absolute right-3 top-3 bg-blue-600 hover:bg-blue-500 w-10 h-10 rounded-xl font-black transition-all">+</button>
            </div>

            <div id="taskList" class="space-y-4 max-h-[400px] overflow-y-auto pr-2"></div>
        </div>
    </div>

    <script>
        const now = new Date();
        const todayNum = now.getDate();
        let db = JSON.parse(localStorage.getItem('lifeos_v22_db') || "{}");
        let health = { water: 0 };
        let currentDayOpen = null;

        document.getElementById('currentMonth').innerText = new Intl.DateTimeFormat('fr-FR', { month: 'long', year: 'numeric' }).format(now);
        document.getElementById('clock').innerText = new Intl.DateTimeFormat('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' }).format(now);

        function buildCal() {
            const cal = document.getElementById('calendar'); cal.innerHTML = '';
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            let total=0, done=0;

            for(let i=1; i<=daysInMonth; i++) {
                const tasks = db[i] || [];
                const allDone = tasks.length > 0 && tasks.every(t => t.done);
                const d = document.createElement('div');
                d.className = `day ${i === todayNum ? 'day-today' : ''}`;
                d.innerText = i;
                if(tasks.length) {
                    const dot = document.createElement('div');
                    dot.className = `w-1.5 h-1.5 rounded-full mt-1 ${allDone ? 'bg-green-500' : 'bg-red-500'}`;
                    d.appendChild(dot);
                    total++; if(allDone) done++;
                }
                d.onclick = () => showDay(i);
                cal.appendChild(d);
            }
            document.getElementById('score').innerText = total ? Math.round(done/total*100) + "%" : "0%";
        }

        function showDay(day) {
            currentDayOpen = day;
            const tasks = db[day] || [];
            document.getElementById('modalDate').innerText = `${day} ${new Intl.DateTimeFormat('fr-FR', { month: 'long' }).format(now)}`;
            
            document.getElementById('taskList').innerHTML = tasks.length ? tasks.map((t, i) => `
                <div class="task-card p-6 flex items-center justify-between group">
                    <div class="flex items-center gap-5 w-full">
                        <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${day},${i})" class="w-5 h-5 accent-blue-500 cursor-pointer">
                        <span class="text-sm font-semibold tracking-tight ${t.done ? 'strikethrough' : 'opacity-90'}">${t.text}</span>
                    </div>
                    <button onclick="delTask(${day},${i})" class="opacity-0 group-hover:opacity-100 text-red-500 transition-all px-2">‚úï</button>
                </div>
            `).join('') : '<p class="text-center py-10 opacity-10 italic text-sm">Aucune mission assign√©e.</p>';
            
            document.getElementById('dayModal').classList.remove('hidden');
        }

        function addTaskManually() {
            const val = document.getElementById('newTaskInput').value;
            if(!val) return;
            db[currentDayOpen] = [...(db[currentDayOpen] || []), {text: val, done: false}];
            save(); document.getElementById('newTaskInput').value = '';
        }

        function toggleTask(d,i) { db[d][i].done = !db[d][i].done; save(); }
        function delTask(d,i) { db[d].splice(i,1); save(); }
        function save() { localStorage.setItem('lifeos_v22_db', JSON.stringify(db)); showDay(currentDayOpen); buildCal(); }
        function closeDay() { document.getElementById('dayModal').classList.add('hidden'); }
        function addWater(n) { health.water = Math.min(3, health.water + n); document.getElementById('waterCount').innerText = health.water; document.getElementById('waterBar').style.width = (health.water/3*100) + "%"; }
        
        async function traiter() {
            const input = document.getElementById('userInput').value;
            if(!input) return;
            const btn = document.getElementById('btnMain');
            btn.innerText = "CALCUL NEURAL..."; btn.disabled = true;
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{role: "system", content: "JSON STRICT: { 'coach': '...', 'yt_search': '...', 'prio': '...', 'schedule': [{'day': N, 'tasks':['...']}] }"}, {role: "user", content: input}]
                    })
                });
                const data = await response.json();
                const res = JSON.parse(data.choices[0].message.content.trim().match(/\{.*\}/s)[0]);
                document.getElementById('coachCard').classList.remove('opacity-40');
                document.getElementById('coachTxt').innerText = res.coach;
                document.getElementById('prioList').innerText = res.prio;
                if(res.yt_search) { const yt = document.getElementById('ytLink'); yt.classList.remove('hidden'); yt.href = `https://youtube.com/results?search_query=${res.yt_search}`; }
                res.schedule.forEach(s => { db[s.day] = [...(db[s.day] || []), ...s.tasks.map(t => ({text: t, done: false}))]; });
                save();
            } catch (e) { alert("Erreur IA"); }
            finally { btn.innerText = "Analyser le flux"; btn.disabled = false; }
        }

        buildCal();
    </script>
</body>
</html>
