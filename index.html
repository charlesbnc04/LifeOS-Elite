<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>LifeOS Sovereign V23 - Deep Awareness</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #000; color: #fff; -webkit-font-smoothing: antialiased; }
        .glass { border-radius: 2.5rem; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(50px); background: rgba(255,255,255,0.02); }
        .day { aspect-ratio: 1; border-radius: 1.2rem; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); }
        .day-today { border: 2px solid #3b82f6 !important; background: rgba(59, 130, 246, 0.1); }
        .water-progress { height: 100%; background: linear-gradient(90deg, #3b82f6, #06b6d4); transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); shadow: 0 0 15px #3b82f6; }
        .task-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 1.5rem; transition: 0.3s; }
        @keyframes pulse-red { 0%, 100% { border-color: rgba(239, 68, 68, 0.2); } 50% { border-color: #ef4444; } }
        .urgent-border { animation: pulse-red 2s infinite; border-width: 2px; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-[1600px] mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-3 space-y-6">
            <div class="glass p-8 space-y-10">
                <h1 class="text-4xl font-black italic tracking-tighter">LIFE<span class="text-blue-500">OS</span></h1>
                
                <div class="space-y-4">
                    <p class="text-[9px] font-black uppercase tracking-widest text-blue-400 italic">R√©veil Intelligent</p>
                    <div class="p-6 bg-blue-500/5 rounded-[2rem] border border-blue-500/20 text-center">
                        <p id="sleepAdvice" class="text-5xl font-black italic text-blue-500">07:30</p>
                        <p id="sleepReason" class="text-[8px] opacity-40 font-bold mt-2 uppercase tracking-tighter">Bas√© sur 8h de sommeil</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <p class="text-[9px] font-black uppercase tracking-widest text-purple-400 italic">Diagnostic IA</p>
                    <div id="aiDiagnostic" class="p-6 bg-purple-500/5 rounded-3xl border border-purple-500/20 text-xs italic opacity-80 leading-relaxed">
                        En attente d'analyse...
                    </div>
                    <a id="ytLink" target="_blank" class="hidden w-full py-3 bg-red-600 rounded-xl text-center text-[9px] font-black uppercase">Solution Vid√©o üé¨</a>
                </div>
            </div>

            <div class="glass p-8 space-y-6">
                <div class="flex justify-between items-end">
                    <p class="text-[9px] font-black uppercase opacity-30">Performance</p>
                    <span id="score" class="text-3xl font-black text-blue-500">0%</span>
                </div>
                <div class="h-2 w-full bg-white/5 rounded-full overflow-hidden"><div id="waterBar" class="water-progress w-0"></div></div>
                <div class="flex gap-2">
                    <button onclick="addWater(0.5)" class="flex-1 py-4 glass text-[10px] font-black hover:bg-white/5">+0.5L</button>
                    <button onclick="addWater(1.5)" class="flex-1 py-4 glass text-[10px] font-black hover:bg-white/5">+1.5L</button>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-5 space-y-6">
            <div class="glass p-10">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-[9px] font-black text-blue-500 uppercase">Neural Engine</span>
                    <button onclick="toggleVoice()" id="voiceBtn" class="w-10 h-10 glass rounded-full flex items-center justify-center">üé§</button>
                </div>
                <textarea id="userInput" class="w-full bg-transparent outline-none text-2xl font-light mb-6 min-h-[120px]" placeholder="Notez une urgence ou un ressenti..."></textarea>
                <button onclick="traiter()" id="btnMain" class="w-full bg-blue-600 py-6 rounded-3xl font-black uppercase text-[10px] tracking-widest shadow-lg shadow-blue-900/20">Mettre √† jour le syst√®me</button>
            </div>

            <div class="glass p-8 space-y-4">
                <p class="text-[9px] font-black text-red-500 uppercase italic">Urgences d√©tect√©es</p>
                <div id="emergencyList" class="space-y-3">
                    <p class="text-xs opacity-20 italic">Calme plat. Aucune menace.</p>
                </div>
            </div>
        </main>

        <section class="lg:col-span-4 glass p-8 space-y-6">
            <h2 id="currentMonth" class="font-black text-2xl tracking-tighter italic uppercase underline decoration-blue-500 decoration-4 underline-offset-8">Roadmap</h2>
            <div id="calendar" class="grid grid-cols-7 gap-3"></div>
        </section>
    </div>

    <div id="dayModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/90 backdrop-blur-3xl">
        <div class="glass p-10 max-w-xl w-full space-y-8">
            <div class="flex justify-between items-center">
                <h2 id="modalDate" class="text-4xl font-black italic text-blue-500 capitalize">Date</h2>
                <button onclick="closeDay()" class="text-2xl opacity-20 hover:opacity-100">‚úï</button>
            </div>
            <div class="relative">
                <input type="text" id="newTaskInput" placeholder="Nouvelle mission..." class="w-full bg-white/5 p-5 rounded-2xl outline-none border border-white/10">
                <button onclick="addTaskManually()" class="absolute right-3 top-3 bg-blue-600 w-10 h-10 rounded-xl font-black">+</button>
            </div>
            <div id="taskList" class="space-y-4 max-h-[400px] overflow-y-auto"></div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('lifeos_v23_db') || "{}");
        let health = JSON.parse(localStorage.getItem('lifeos_v23_health') || '{"water":0}');
        const now = new Date();
        const todayNum = now.getDate();
        let currentDayOpen = null;

        // --- MOTEUR D'INTELLIGENCE ---
        function globalUpdate() {
            // 1. Calcul du R√©veil (Scan des t√¢ches de demain)
            const tomorrowTasks = db[todayNum + 1] || [];
            let earlyTime = "07:30";
            let reason = "Bas√© sur 8h de sommeil";
            
            tomorrowTasks.forEach(t => {
                const match = t.text.match(/([0-9]+)h([0-9]*)/);
                if(match) {
                    let hour = parseInt(match[1]);
                    let min = match[2] ? parseInt(match[2]) : 0;
                    let alarmH = hour - 2; // R√©veil 2h avant
                    earlyTime = `${alarmH.toString().padStart(2,'0')}:${min.toString().padStart(2,'0')}`;
                    reason = `R√©veil anticip√© pour mission √† ${match[0]}`;
                }
            });
            document.getElementById('sleepAdvice').innerText = earlyTime;
            document.getElementById('sleepReason').innerText = reason;

            // 2. Scan des Urgences & Diagnostic
            const urgBox = document.getElementById('emergencyList');
            const diagBox = document.getElementById('aiDiagnostic');
            const yt = document.getElementById('ytLink');
            let urgHtml = "";
            let hasUrgent = false;

            // Check Retards
            for(let d=1; d<todayNum; d++) {
                if(db[d] && db[d].some(t => !t.done)) {
                    urgHtml += `<div class="p-4 bg-red-500/10 border border-red-500/30 rounded-2xl text-[10px] font-bold text-red-500 flex justify-between items-center"><span>‚ö†Ô∏è RETARD : MISSION DU ${d} NON VALID√âE</span><button onclick="showDay(${d})" class="underline">VOIR</button></div>`;
                    hasUrgent = true;
                }
            }
            
            // Check Sant√©/Mots cl√©s
            let allText = JSON.stringify(db).toLowerCase();
            if(allText.includes("mal") || allText.includes("dos") || allText.includes("cervicale")) {
                diagBox.innerHTML = "L'IA d√©tecte une tension physique. Recommandation : S√©ance de d√©compression vert√©brale (15min).";
                yt.classList.remove('hidden');
                yt.href = "https://www.youtube.com/results?search_query=soulager+mal+de+dos+yoga";
            } else {
                diagBox.innerHTML = "Syst√®me nominal. Continuez l'optimisation.";
                yt.classList.add('hidden');
            }

            urgBox.innerHTML = urgHtml || `<p class="text-xs opacity-20 italic text-center">Calme plat. Aucune menace.</p>`;

            // 3. Eau & Score
            document.getElementById('waterBar').style.width = (health.water / 3 * 100) + "%";
            let totalT=0, doneT=0;
            Object.values(db).forEach(day => day.forEach(t => { totalT++; if(t.done) doneT++; }));
            document.getElementById('score').innerText = Math.round((health.water/3*40) + (totalT ? (doneT/totalT*60) : 0)) + "%";
            
            buildCal();
        }

        function addWater(n) { health.water = Math.min(3, health.water + n); saveHealth(); }
        function saveHealth() { localStorage.setItem('lifeos_v23_health', JSON.stringify(health)); globalUpdate(); }

        function buildCal() {
            const cal = document.getElementById('calendar'); cal.innerHTML = '';
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            for(let i=1; i<=daysInMonth; i++) {
                const tasks = db[i] || [];
                const allDone = tasks.length > 0 && tasks.every(t => t.done);
                const hasLate = i < todayNum && tasks.some(t => !t.done);
                const d = document.createElement('div');
                d.className = `day ${i === todayNum ? 'day-today' : ''} ${hasLate ? 'urgent-border' : ''}`;
                d.innerHTML = `<span class="text-[10px] font-bold">${i}</span>`;
                if(tasks.length) {
                    const dot = document.createElement('div');
                    dot.className = `w-1 h-1 rounded-full mt-1 ${allDone ? 'bg-green-500' : 'bg-red-500'}`;
                    d.appendChild(dot);
                }
                d.onclick = () => showDay(i);
                cal.appendChild(d);
            }
        }

        function showDay(day) {
            currentDayOpen = day;
            const tasks = db[day] || [];
            document.getElementById('modalDate').innerText = `${day} D√©cembre`;
            document.getElementById('taskList').innerHTML = tasks.length ? tasks.map((t, idx) => `
                <div class="task-card p-5 flex items-center justify-between group">
                    <div class="flex items-center gap-4">
                        <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${day},${idx})" class="w-5 h-5 accent-blue-500">
                        <span class="text-sm ${t.done ? 'line-through opacity-20' : 'font-bold'}">${t.text}</span>
                    </div>
                    <button onclick="delTask(${day},${idx})" class="opacity-0 group-hover:opacity-100 text-red-500">‚úï</button>
                </div>
            `).join('') : '<p class="text-center py-10 opacity-20 italic">Vide.</p>';
            document.getElementById('dayModal').classList.remove('hidden');
        }

        async function traiter() {
            const input = document.getElementById('userInput').value;
            if(!input) return;
            // Simulation IA rapide pour l'exemple
            if(input.toLowerCase().includes("1.5")) addWater(1.5);
            if(input.toLowerCase().includes("m√©decin")) {
                db[todayNum+1] = [...(db[todayNum+1]||[]), {text: "RDV M√©decin √† 08h30", done: false}];
            }
            document.getElementById('userInput').value = "";
            save();
        }

        function addTaskManually() {
            const val = document.getElementById('newTaskInput').value;
            if(!val) return;
            db[currentDayOpen] = [...(db[currentDayOpen] || []), {text: val, done: false}];
            save(); document.getElementById('newTaskInput').value = '';
        }
        function toggleTask(d,i) { db[d][i].done = !db[d][i].done; save(); }
        function delTask(d,i) { db[d].splice(i,1); save(); }
        function save() { localStorage.setItem('lifeos_v23_db', JSON.stringify(db)); showDay(currentDayOpen); globalUpdate(); }
        function closeDay() { document.getElementById('dayModal').classList.add('hidden'); }
        
        globalUpdate();
    </script>
</body>
</html>
